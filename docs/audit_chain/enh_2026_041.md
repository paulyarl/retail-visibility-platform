# Governance Linkage — ENH-2026-041 & ENH-2026-042

## Traceability Chain

### ENH-2026-041: MapCard Component

**ID:** ENH-2026-041  
**Status:** Implemented (Frontend Complete)  
**Owner:** Frontend Lead  
**Reviewer:** QA Lead, Accessibility Specialist  

**Artifacts:**
- Component: `/apps/web/src/components/tenant/MapCard.tsx`
- Settings: `/apps/web/src/components/tenant/MapCardSettings.tsx`
- Hook: `/apps/web/src/hooks/useGeocode.ts`
- Tests: `/apps/web/src/__tests__/tenant/MapCard.test.tsx` (pending)
- A11y Audit: `/qa/a11y/map_audit.json` (pending)

**Dependencies:**
- Google Maps API
- Geocoding service
- Business Profile (REQ-2026-010)

**Compliance:**
- GDPR Article 6, 17 (Data minimization, deletion)
- CCPA (Privacy mode implementation)
- WCAG 2.1 AA (Accessibility)

---

### ENH-2026-042: SWIS Feed Preview Widget

**ID:** ENH-2026-042  
**Status:** Implemented (Frontend Complete)  
**Owner:** Backend Lead (API pending), Frontend Lead (UI complete)  
**Reviewer:** QA Lead, Security Engineer  

**Artifacts:**
- Widget: `/apps/web/src/components/tenant/SwisPreviewWidget.tsx`
- Product Card: `/apps/web/src/components/tenant/SwisProductCard.tsx`
- Settings: `/apps/web/src/components/tenant/SwisPreviewSettings.tsx`
- Hook: `/apps/web/src/hooks/useSwisPreview.ts`
- Tests: `/apps/web/src/__tests__/tenant/SwisPreview.test.tsx` (pending)
- Sanitization Tests: `/qa/tests/swis_sanitize.test.ts` (pending)

**Dependencies:**
- SWIS Feed API
- Inventory system (REQ-2025-201)
- Analytics (REQ-2025-701)

**Compliance:**
- PII sanitization (no wholesale costs, supplier IDs)
- Public-safe signed routes
- Rate limiting

---

## QA Ownership Matrix

| Test Suite | Owner | Status | Artifact |
|------------|-------|--------|----------|
| MapCard Unit Tests | QA Lead | Pending | `/qa/tests/map_card.test.ts` |
| Map Privacy Tests | QA Lead | Pending | `/qa/tests/map_privacy.test.ts` |
| SWIS Preview Unit Tests | QA Lead | Pending | `/qa/tests/swis_preview.test.ts` |
| SWIS Sanitization Tests | Security Engineer | Pending | `/qa/tests/swis_sanitize.test.ts` |
| Accessibility Audit | Accessibility Specialist | Pending | `/qa/a11y/map_swis_audit.json` |
| E2E Integration Tests | QA Lead | Pending | `/qa/e2e/tenant_enhancements.spec.ts` |
| Performance Tests | DevOps | Pending | `/qa/performance/map_swis_load.test.ts` |

---

## Security & Privacy Controls

### MapCard Privacy Controls

**Privacy Mode Implementation:**
- **Precise Mode:** Exact coordinates displayed
- **Neighborhood Mode:** Coordinates rounded to ±0.002° (≈200m radius)

**PII Minimization:**
- Coordinates derived from address, not stored separately
- DSR compliance: Auto-delete on profile deletion
- No tracking pixels or analytics in map embed

**API Security:**
- Server-side API key storage
- Rate limiting: 5 requests/min per tenant
- Audit logging on geocode requests

### SWIS Preview Sanitization

**Excluded Fields:**
- Wholesale cost
- Supplier IDs
- Internal notes
- Margin calculations
- Purchase history

**Included Fields (Public-Safe):**
- SKU, title, brand
- Price, currency
- Image URL
- Availability
- Category path
- Updated timestamp

**Security Controls:**
- Signed routes for preview access
- CDN caching (60-300s TTL)
- Rate limiting: 100 requests/min per tenant
- No PII in responses

---

## Performance Targets

### MapCard Performance

| Metric | Target | Current | Status |
|--------|--------|---------|--------|
| Map load time (p95) | <250ms | TBD | Pending validation |
| Geocode API latency (p95) | <500ms | TBD | Pending validation |
| Error rate | <1% | TBD | Pending validation |
| Cache hit rate | >90% | TBD | Pending implementation |

### SWIS Preview Performance

| Metric | Target | Current | Status |
|--------|--------|---------|--------|
| Preview load time (p95) | <300ms | TBD | Pending validation |
| Image load time (p95) | <500ms | TBD | Pending validation |
| Error rate | <1% | TBD | Pending validation |
| Cache hit rate | >85% | TBD | Pending implementation |

---

## Accessibility Compliance

### WCAG 2.1 AA Requirements

**MapCard:**
- ✅ Keyboard navigation (Tab, Enter, Escape)
- ✅ Screen reader labels (ARIA)
- ✅ Focus indicators
- ✅ Alt text on map iframe
- ⏳ Color contrast validation (pending audit)
- ⏳ Lighthouse score ≥95 (pending validation)

**SWIS Preview:**
- ✅ Product card keyboard navigation
- ✅ Image alt text
- ✅ Price formatting for screen readers
- ✅ Badge ARIA labels
- ⏳ Color contrast validation (pending audit)
- ⏳ Lighthouse score ≥95 (pending validation)

**Remediation SLA:** 30 days per critical issue

---

## SEO Integration

### Schema.org Markup (Pending Implementation)

**LocalBusiness Schema:**
```json
{
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": "{{business_name}}",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "{{address_line1}}",
    "addressLocality": "{{city}}",
    "addressRegion": "{{state}}",
    "postalCode": "{{postal_code}}",
    "addressCountry": "{{country_code}}"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "{{latitude}}",
    "longitude": "{{longitude}}"
  }
}
```

**Product Schema:**
```json
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{title}}",
  "brand": "{{brand}}",
  "offers": {
    "@type": "Offer",
    "price": "{{price}}",
    "priceCurrency": "{{currency}}",
    "availability": "https://schema.org/InStock"
  }
}
```

**Target:** Rich Result Coverage ≥90%

---

## Rollout Plan

### Phase 1: Backend + Schema (Week 1)
- Deploy schema migrations
- Implement geocoding API
- Implement SWIS preview API
- Feature flags OFF

### Phase 2: Staging Validation (Week 2)
- Enable flags on staging
- Run QA test suite
- Accessibility audit
- Performance validation

### Phase 3: Pilot Cohort (Week 3)
- Enable for 20% of tenants
- Monitor metrics
- Collect feedback
- A/B testing vs control

### Phase 4: Full Rollout (Week 4)
- Enable for 100% if metrics met
- Monitor for 7 days
- Document lessons learned

---

## Risk Mitigation

| Risk | Impact | Probability | Mitigation | Owner |
|------|--------|-------------|------------|-------|
| API quota exceeded | High | Medium | Static map fallback, rate limiting | Backend Lead |
| Privacy violation | Critical | Low | Privacy mode enforcement, audit logs | Legal/Security |
| Performance degradation | Medium | Medium | CDN caching, lazy loading | DevOps |
| Accessibility failure | High | Low | Pre-launch audit, remediation SLA | Accessibility Specialist |
| Feature regression | Medium | Low | E2E test suite, rollback plan | QA Lead |

---

## Compliance Checklist

### GDPR Compliance
- [ ] Data minimization (coordinates derived, not stored)
- [ ] Right to deletion (DSR automation)
- [ ] Consent management (privacy mode)
- [ ] Audit logging

### CCPA Compliance
- [ ] Data minimization verified
- [ ] Privacy policy updated
- [ ] Opt-out mechanism (privacy mode)

### WCAG 2.1 AA Compliance
- [ ] Keyboard navigation
- [ ] Screen reader support
- [ ] Color contrast
- [ ] Focus indicators
- [ ] Alt text

---

## Monitoring & Observability

### Metrics to Track

**MapCard:**
- `mapcard_renders` (counter)
- `mapcard_errors` (counter)
- `geocode_requests` (counter)
- `geocode_cache_hits` (counter)
- `map_load_time` (histogram)

**SWIS Preview:**
- `swis_preview_requests` (counter)
- `swis_preview_errors` (counter)
- `swis_preview_ctr` (gauge)
- `swis_cache_hits` (counter)
- `swis_load_time` (histogram)

**Dashboards:**
- Datadog: `dd_dashboard_id=rvp_swis_v2`
- Grafana: `rvp_tenant_enhancements`

---

## Approval Status

| Approver | Role | Status | Date |
|----------|------|--------|------|
| Product Lead | Product | Pending | - |
| Engineering Lead | Engineering | Pending | - |
| QA Lead | QA | Pending | - |
| Security Engineer | Security | Pending | - |
| Accessibility Specialist | Accessibility | Pending | - |
| Legal/Compliance | Legal | Pending | - |

---

## Next Actions

1. **Immediate:**
   - [ ] Create QA test files
   - [ ] Run accessibility audit
   - [ ] Implement schema.org markup
   - [ ] Set up monitoring dashboards

2. **Backend (Week 1):**
   - [ ] Implement geocoding API
   - [ ] Implement SWIS preview API
   - [ ] Set up caching layer
   - [ ] Configure feature flags

3. **QA (Week 2):**
   - [ ] Run full test suite
   - [ ] Validate performance targets
   - [ ] Accessibility audit
   - [ ] Security review

4. **Rollout (Week 3-4):**
   - [ ] Pilot cohort enablement
   - [ ] Monitor metrics
   - [ ] Full rollout if approved

---

**Document Version:** 1.0  
**Last Updated:** 2025-10-21  
**Status:** Ready for Review  
**Next Review:** Pre-deployment validation
