generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model audit_log {
  id           String      @id
  tenant_id    String
  actor_id     String
  actor_type   actor_type
  diff         Json
  entity_id    String
  entity_type  entity_type
  ip           String?
  metadata     Json        @default("{}")
  occurred_at  DateTime    @default(now())
  pii_scrubbed Boolean     @default(true)
  request_id   String?
  user_agent   String?
  action       action

  @@index([tenant_id, occurred_at(sort: Desc)], map: "audit_log_tenant_id_occurred_at_sort_desc_idx")
}

model barcode_enrichment {
  id                  String   @id
  barcode             String   @unique
  name                String?
  brand               String?
  description         String?
  category_path       String[]
  price_cents         Int?
  image_url           String?
  image_thumbnail_url String?
  metadata            Json?
  source              String
  last_fetched_at     DateTime @default(now())
  fetch_count         Int      @default(1)
  created_at          DateTime @default(now())
  updated_at          DateTime
}

model barcode_lookup_log {
  id         String   @id
  tenant_id  String
  barcode    String
  provider   String?
  status     String   @default("success")
  response   Json?
  latency_ms Int?
  error      String?
  created_at DateTime @default(now())
}

model business_hours_list {
  id             String    @id
  tenant_id      String    @unique
  timezone       String    @default("America/New_York")
  periods        Json      @default("[]")
  source_hash    String?
  last_synced_at DateTime?
  sync_attempts  Int       @default(0)
  last_error     String?
  created_at     DateTime  @default(now())
  updated_at     DateTime
  tenants        tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
}

model business_hours_special_list {
  id             String    @id
  tenant_id      String
  date           DateTime  @db.Date
  isClosed       Boolean   @default(false)
  open           String?
  close          String?
  note           String?
  source_hash    String?
  last_synced_at DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime
  tenants        tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, date])
  @@index([tenant_id, date])
}

model category_mirror_runs {
  id           String    @id
  tenant_id    String?
  strategy     String
  dry_run      Boolean   @default(true)
  created      Int       @default(0)
  updated      Int       @default(0)
  deleted      Int       @default(0)
  skipped      Boolean   @default(false)
  reason       String?
  error        String?
  job_id       String?
  started_at   DateTime  @default(now())
  completed_at DateTime?
  tenants      tenants?  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id, strategy, started_at(sort: Desc)], map: "category_mirror_runs_tenant_id_strategy_started_at_sort_desc_")
}

model clover_demo_snapshots_list {
  id                       String                   @id
  integration_id           String
  snapshot_data            Json
  item_count               Int
  created_at               DateTime                 @default(now())
  expires_at               DateTime
  clover_integrations_list clover_integrations_list @relation(fields: [integration_id], references: [id], onDelete: Cascade)
}

model clover_integrations_list {
  id                         String                       @id
  tenant_id                  String
  mode                       String                       @default("demo")
  status                     String                       @default("active")
  access_token               String?
  refresh_token              String?
  token_expires_at           DateTime?
  merchant_id                String?
  demo_enabled_at            DateTime?
  demo_last_active_at        DateTime?
  production_enabled_at      DateTime?
  last_sync_at               DateTime?
  last_sync_status           String?
  created_at                 DateTime                     @default(now())
  updated_at                 DateTime
  clover_demo_snapshots_list clover_demo_snapshots_list[]
  clover_item_mappings_list  clover_item_mappings_list[]
  clover_sync_logs_list      clover_sync_logs_list[]
}

model clover_item_mappings_list {
  id                       String                   @id
  integration_id           String
  clover_item_id           String
  clover_item_name         String
  clover_sku               String?
  rvp_item_id              String?
  rvp_sku                  String?
  mapping_status           String                   @default("pending")
  conflict_reason          String?
  last_synced_at           DateTime?
  last_sync_status         String?
  created_at               DateTime                 @default(now())
  updated_at               DateTime
  clover_integrations_list clover_integrations_list @relation(fields: [integration_id], references: [id], onDelete: Cascade)
}

model clover_sync_logs_list {
  id                       String                   @id
  integration_id           String
  trace_id                 String
  operation                String
  status                   String
  items_processed          Int                      @default(0)
  items_succeeded          Int                      @default(0)
  items_failed             Int                      @default(0)
  error_message            String?
  error_details            Json?
  duration_ms              Int?
  started_at               DateTime                 @default(now())
  completed_at             DateTime?
  clover_integrations_list clover_integrations_list @relation(fields: [integration_id], references: [id], onDelete: Cascade)
}

model directory_category {
  id                 String   @id
  tenantId           String   @map("tenantId")
  name               String
  slug               String
  parentId           String?  @map("parentId")
  googleCategoryId   String?  @map("googleCategoryId")
  isActive           Boolean  @default(true) @map("isActive")
  sortOrder          Int      @default(0) @map("sortOrder")
  createdAt          DateTime @default(now()) @map("createdAt")
  updatedAt          DateTime @updatedAt @map("updatedAt")
}

model directory_category_mv_refresh_log {
  id                   Int       @id @default(autoincrement())
  refresh_started_at   DateTime? @default(now()) @db.Timestamptz(6)
  refresh_completed_at DateTime? @db.Timestamptz(6)
  refresh_duration_ms  Int?
  status               String?   @default("running")
  error_message        String?
  records_affected     Int?
  trigger_source       String?

  @@index([refresh_started_at], map: "idx_mv_refresh_started_at")
  @@index([status], map: "idx_mv_refresh_status")
  @@index([trigger_source], map: "idx_mv_refresh_trigger_source")
}

model directory_featured_listings_list {
  id                 String   @id
  tenant_id          String
  featured_from      DateTime
  featured_until     DateTime
  placement_priority Int      @default(5)
  created_by         String?
  created_at         DateTime @default(now())
  users              users?   @relation(fields: [created_by], references: [id], onDelete: Cascade)
  tenants            tenants  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([placement_priority, featured_from(sort: Desc)])
  @@index([tenant_id, featured_until])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model directory_listing_categories {
  listing_id  String
  category_id String
  is_primary  Boolean?  @default(false)
  created_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@id([listing_id, category_id])
  @@index([category_id], map: "idx_directory_listing_categories_category")
  @@index([category_id, is_primary], map: "idx_directory_listing_categories_category_primary")
  @@index([listing_id], map: "idx_directory_listing_categories_listing")
}

model directory_listings_list {
  id                   String    @id
  tenant_id            String
  business_name        String?
  slug                 String?
  address              String?
  city                 String?
  state                String?
  zip_code             String?
  phone                String?
  email                String?
  website              String?
  latitude             Float?
  longitude            Float?
  primary_category     String?
  secondary_categories String[]
  logo_url             String?
  description          String?
  business_hours       Json?
  rating_avg           Float?    @default(0)
  rating_count         Int?      @default(0)
  product_count        Int?      @default(0)
  is_featured          Boolean?  @default(false)
  subscription_tier    String?   @default("trial")
  use_custom_website   Boolean?  @default(false)
  is_published         Boolean?  @default(true)
  created_at           DateTime? @default(now()) @db.Timestamptz(6)
  updated_at           DateTime? @default(now()) @db.Timestamptz(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model directory_mv_refresh_log {
  id                   Int       @id @default(autoincrement())
  view_name            String
  refresh_started_at   DateTime  @default(now()) @db.Timestamptz(6)
  refresh_completed_at DateTime? @db.Timestamptz(6)
  refresh_duration_ms  Int?
  rows_affected        Int?
  triggered_by         String?
  error_message        String?
  status               String?   @default("in_progress")

  @@index([status, refresh_started_at(sort: Desc)], map: "idx_directory_mv_refresh_log_status")
  @@index([view_name, refresh_started_at(sort: Desc)], map: "idx_directory_mv_refresh_log_view_name")
}

model directory_settings_list {
  id                   String    @id
  tenant_id            String    @unique
  is_published         Boolean   @default(false)
  seo_description      String?
  seo_keywords         String[]
  primary_category     String?
  secondary_categories String[]
  is_featured          Boolean   @default(false)
  featured_until       DateTime?
  slug                 String?   @unique
  created_at           DateTime  @default(now())
  updated_at           DateTime
  tenants              tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
}

model directory_support_notes_list {
  id         String   @id
  tenant_id  String
  note       String
  created_by String
  created_at DateTime @default(now())
}

model email_configuration_list {
  id         String   @id
  category   String   @unique
  email      String
  updated_at DateTime
  updated_by String?
}

model feed_push_jobs_list {
  id            String     @id
  tenant_id     String
  sku           String?
  job_status    job_status @default(queued)
  retry_count   Int        @default(0)
  max_retries   Int        @default(5)
  last_attempt  DateTime?
  next_retry    DateTime?
  error_message String?
  error_code    String?
  payload       Json?
  result        Json?
  created_at    DateTime   @default(now()) @db.Timestamptz(6)
  updated_at    DateTime   @db.Timestamptz(6)
  completed_at  DateTime?  @db.Timestamptz(6)
}

model gbp_categories_list {
  id                            String                          @id
  name                          String                          @unique
  display_name                  String
  is_active                     Boolean                         @default(true)
  created_at                    DateTime                        @default(now()) @db.Timestamptz(6)
  updated_at                    DateTime                        @db.Timestamptz(6)
  tenant_business_profiles_list tenant_business_profiles_list[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model gbp_category_mappings {
  gbp_category_id           String    @id
  gbp_category_name         String
  gbp_category_display_name String?
  platform_category_id      String?
  is_active                 Boolean?  @default(true)
  mapping_confidence        String?
  mapping_notes             String?
  tenant_count              Int?      @default(0)
  last_used_at              DateTime? @db.Timestamptz(6)
  created_at                DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                DateTime? @default(now()) @db.Timestamptz(6)
  created_by                String?
  updated_by                String?

  @@index([mapping_confidence], map: "idx_gbp_category_mappings_confidence")
  @@index([tenant_count(sort: Desc), last_used_at(sort: Desc)], map: "idx_gbp_category_mappings_usage")
}

model gbp_insights_daily_list {
  id                 String             @id
  location_id        String
  date               DateTime           @db.Date
  views_search       Int                @default(0)
  views_maps         Int                @default(0)
  actions_website    Int                @default(0)
  actions_phone      Int                @default(0)
  actions_directions Int                @default(0)
  photos_count       Int                @default(0)
  created_at         DateTime           @default(now()) @db.Timestamptz(6)
  gbp_locations_list gbp_locations_list @relation(fields: [location_id], references: [id], onDelete: Cascade)

  @@unique([location_id, date])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model gbp_listing_categories {
  listing_id      String
  gbp_category_id String
  is_primary      Boolean  @default(false)
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  updated_at      DateTime @default(now()) @db.Timestamptz(6)

  @@id([listing_id, gbp_category_id])
  @@index([gbp_category_id], map: "idx_gbp_listing_categories_category")
  @@index([gbp_category_id, is_primary], map: "idx_gbp_listing_categories_category_primary")
  @@index([listing_id], map: "idx_gbp_listing_categories_listing")
}

model gbp_locations_list {
  id                         String                     @id
  account_id                 String
  location_id                String
  location_name              String
  store_code                 String?
  address                    String?
  phone_number               String?
  website_url                String?
  category                   String?
  is_verified                Boolean?                   @default(false)
  is_published               Boolean?                   @default(false)
  last_fetched_at            DateTime?                  @db.Timestamptz(6)
  created_at                 DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime                   @db.Timestamptz(6)
  gbp_insights_daily_list    gbp_insights_daily_list[]
  google_oauth_accounts_list google_oauth_accounts_list @relation(fields: [account_id], references: [id], onDelete: Cascade)

  @@unique([account_id, location_id])
}

model google_merchant_links_list {
  id                         String                     @id
  account_id                 String
  merchant_id                String
  merchant_name              String?
  website_url                String?
  is_active                  Boolean                    @default(true)
  last_sync_at               DateTime?                  @db.Timestamptz(6)
  sync_status                String?                    @default("pending")
  sync_error                 String?
  created_at                 DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime                   @db.Timestamptz(6)
  google_oauth_accounts_list google_oauth_accounts_list @relation(fields: [account_id], references: [id], onDelete: Cascade)

  @@index([account_id])
}

model google_oauth_accounts_list {
  id                         String                       @id
  tenant_id                  String
  google_account_id          String
  email                      String
  display_name               String?
  profile_picture_url        String?
  scopes                     String[]
  created_at                 DateTime                     @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime                     @db.Timestamptz(6)
  gbp_locations_list         gbp_locations_list[]
  google_merchant_links_list google_merchant_links_list[]
  tenants                    tenants                      @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  google_oauth_tokens_list   google_oauth_tokens_list?

  @@unique([tenant_id, google_account_id])
}

model google_oauth_tokens_list {
  id                         String                     @id
  account_id                 String                     @unique
  access_token_encrypted     String
  refresh_token_encrypted    String
  token_type                 String                     @default("Bearer")
  expires_at                 DateTime                   @db.Timestamptz(6)
  scopes                     String[]
  created_at                 DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime                   @db.Timestamptz(6)
  google_oauth_accounts_list google_oauth_accounts_list @relation(fields: [account_id], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model google_taxonomy_list {
  id            String   @id
  category_id   String   @unique
  category_path String
  parent_id     String?
  level         Int
  is_active     Boolean  @default(true)
  version       String   @default("2024-09")
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @db.Timestamptz(6)
}

model inventory_items {
  id                    String                   @id
  tenant_id             String
  sku                   String
  name                  String
  price_cents           Int
  stock                 Int                      @default(0)
  image_url             String?
  metadata              Json?
  created_at            DateTime                 @default(now())
  updated_at            DateTime
  marketing_description String?
  image_gallery         String[]                 @default([])
  custom_cta            Json?
  social_links          Json?
  custom_branding       Json?
  custom_sections       Json[]                   @default([])
  landing_page_theme    String?                  @default("default")
  audit_log_id          String?
  availability          availability_status      @default(in_stock)
  brand                 String
  category_path         String[]                 @default([])
  directory_category_id String?
  condition             product_condition?       @default(brand_new)
  currency              String                   @default("USD") @db.Char(3)
  description           String?
  eligibility_reason    String?
  gtin                  String?
  item_status           item_status?             @default(active)
  location_id           String?
  merchant_name         String?
  mpn                   String?
  price                 Decimal                  @db.Decimal(12, 2)
  quantity              Int?
  search_tsv            Unsupported("tsvector")?
  sync_status           sync_status?             @default(pending)
  synced_at             DateTime?                @db.Timestamptz(6)
  title                 String
  visibility            item_visibility?         @default(public)
  manufacturer          String?
  source                product_source           @default(MANUAL)
  enrichment_status     enrichment_status        @default(COMPLETE)
  enriched_at           DateTime?
  enriched_by           String?
  enriched_from_barcode String?
  missing_images        Boolean                  @default(false)
  missing_description   Boolean                  @default(false)
  missing_specs         Boolean                  @default(false)
  missing_brand         Boolean                  @default(false)
  tenants               tenants                  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  photo_assets          photo_assets[]
  product_performances  product_performances[]

  @@unique([tenant_id, sku])
  @@index([source])
  @@index([tenant_id, enrichment_status])
  @@index([tenant_id, updated_at])
}

model invitations {
  id          String           @id @default(dbgenerated("gen_random_uuid()"))
  email       String           @unique
  token       String           @unique @default(dbgenerated("encode(gen_random_bytes(32), 'hex'::text)"))
  tenant_id   String
  role        user_tenant_role @default(MEMBER)
  invited_by  String
  expires_at  DateTime         @default(dbgenerated("(now() + '7 days'::interval)"))
  accepted_at DateTime?
  created_at  DateTime         @default(now())
  updated_at  DateTime         @default(now())
  users       users            @relation(fields: [invited_by], references: [id], onDelete: Cascade)
  tenants     tenants          @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([expires_at])
  @@index([tenant_id])
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model location_status_logs {
  id             String
  tenant_id      String
  old_status     location_status
  new_status     location_status
  changed_by     String
  reason         String?
  reopening_date DateTime?
  metadata       Json?
  created_at     DateTime        @default(now()) @db.Timestamptz(6)
  updated_at     DateTime        @default(now()) @db.Timestamptz(6)

  @@index([changed_by])
  @@index([tenant_id, created_at])
  @@ignore
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model manual_migrations {
  id             Int       @id @default(autoincrement())
  migration_name String    @unique
  description    String?
  executed_at    DateTime? @default(now()) @db.Timestamptz(6)
  executed_by    String?
  rollback_sql   String?
  status         String?   @default("pending")

  @@index([status, executed_at(sort: Desc)], map: "idx_manual_migrations_status")
}

model oauth_integrations {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String?
  provider      String
  access_token  String
  refresh_token String?
  scopes        String[]  @default([])
  expiresAt     DateTime? @db.Timestamptz(6)
  isActive      Boolean?  @default(true)
  metadata      Json?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)
}

model organization_requests_list {
  id              String    @id
  tenant_id       String
  organization_id String
  requested_by    String
  status          String    @default("pending")
  request_type    String    @default("join")
  estimated_cost  Float?
  cost_currency   String?   @default("USD")
  notes           String?
  admin_notes     String?
  cost_agreed     Boolean   @default(false)
  cost_agreed_at  DateTime?
  processed_by    String?
  processed_at    DateTime?
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  updated_at      DateTime  @db.Timestamptz(6)
}

model organizations_list {
  id                     String    @id
  name                   String
  owner_id               String
  created_at             DateTime  @default(now())
  updated_at             DateTime
  subscription_tier      String?   @default("chain_starter")
  subscription_status    String?   @default("trial")
  trial_ends_at          DateTime?
  subscription_ends_at   DateTime?
  stripe_customer_id     String?
  stripe_subscription_id String?
  max_locations          Int       @default(5)
  max_total_skus         Int       @default(2500)
  metadata               Json?
  tenants                tenants[]
}

model outreach_feedback_list {
  id         String   @id
  tenant_id  String?
  user_id    String?
  feedback   Json
  score      Int
  category   String?
  context    String?
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @db.Timestamptz(6)
}

model permission_audit_logs_list {
  id         String   @id
  role       String
  action     String
  old_value  Boolean?
  new_value  Boolean
  changed_by String
  changed_at DateTime @default(now()) @db.Timestamptz(6)
  reason     String?
}

model permission_matrix_list {
  id          String            @id
  role        String
  action      permission_action
  allowed     Boolean           @default(false)
  description String?
  created_at  DateTime          @default(now()) @db.Timestamptz(6)
  updated_at  DateTime          @db.Timestamptz(6)
}

model photo_assets {
  id                String          @id
  tenant_id          String          @map("tenantId")
  inventory_item_id   String          @map("inventoryItemId")
  url               String
  width             Int?
  height            Int?
  content_type       String?         @map("contentType")
  bytes             Int?
  exif_removed       Boolean         @default(false) @map("exifRemoved")
  captured_at        DateTime?       @db.Timestamptz(6) @map("capturedAt")
  created_at         DateTime        @default(now()) @db.Timestamptz(6) @map("createdAt")
  public_url         String?         @map("publicUrl")
  signed_url         String?         @map("signedUrl")
  position          Int             @default(0)
  alt               String?
  caption           String?
  inventory_items   inventory_items @relation(fields: [inventory_item_id], references: [id], onDelete: Cascade)
  tenants           tenants         @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([inventory_item_id, position], map: "photo_assets_inventory_item_id_position_unique")
  @@index([inventory_item_id], map:"idx_photo_assets_inventory_item_id")
  @@index([tenant_id], map:"idx_photo_assets_tenant_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model platform_categories {
  id                 String    @id @default(dbgenerated("('cat_'::text || gen_random_uuid())"))
  name               String
  slug               String    @unique
  description        String?
  google_category_id String    @unique
  parent_id          String?
  level              Int?      @default(0)
  icon_emoji         String?
  sort_order         Int?      @default(0)
  is_active          Boolean?  @default(true)
  is_featured        Boolean?  @default(false)
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @db.Timestamptz(6)

  @@index([google_category_id], map: "idx_platform_categories_google_id")
  @@index([parent_id], map: "idx_platform_categories_parent")
  @@index([slug], map: "idx_platform_categories_slug")
  @@index([sort_order, name], map: "idx_platform_categories_sort")
}

model platform_feature_flags_list {
  id                    String   @id
  flag                  String   @unique
  enabled               Boolean  @default(false)
  description           String?
  rollout               String?
  allow_tenant_override Boolean  @default(false)
  updated_at            DateTime @db.Timestamptz(6)
  created_at            DateTime @db.Timestamptz(6)
}

model platform_settings_list {
  id                   Int      @id @default(1)
  platform_name        String?
  platform_description String?
  logo_url             String?
  favicon_url          String?
  created_at           DateTime @default(now()) @db.Timestamptz(6)
  updated_at           DateTime @db.Timestamptz(6)
}

model product_performances {
  id               String          @id
  item_id          String
  tenant_id        String
  date             DateTime        @db.Date
  approval_status  String?
  rejection_reason String?
  impressions      Int             @default(0)
  clicks           Int             @default(0)
  ctr              Decimal         @default(0) @db.Decimal(5, 2)
  conversions      Int             @default(0)
  revenue          Decimal         @default(0) @db.Decimal(12, 2)
  visibility_score Int             @default(0)
  search_rank      Int?
  last_updated     DateTime        @default(now()) @db.Timestamptz(6)
  created_at       DateTime        @default(now()) @db.Timestamptz(6)
  inventory_items  inventory_items @relation(fields: [item_id], references: [id], onDelete: Cascade)
  tenants          tenants         @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([item_id, date], map: "product_performance_item_id_date_unique")
  @@index([tenant_id, date(sort: Desc)], map: "product_performance_tenant_id_date_sort_desc_idx")
}

model review_helpful_votes {
  id         String   @id
  review_id  String
  user_id    String
  is_helpful Boolean
  created_at DateTime @default(now())

  @@unique([review_id, user_id])
}

model scan_results_list {
  id                 String             @id
  tenant_id          String
  session_id         String
  barcode            String
  sku                String?
  raw_payload        Json?
  status             String             @default("new")
  enrichment         Json?
  validation         Json?
  duplicate_of       String?
  error              String?
  created_at         DateTime           @default(now()) @db.Timestamptz(6)
  updated_at         DateTime           @default(now()) @db.Timestamptz(6)
  scan_sessions_list scan_sessions_list @relation(fields: [session_id], references: [id], onDelete: Cascade)
  tenants            tenants            @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([barcode])
  @@index([session_id])
  @@index([tenant_id])
}

model scan_sessions_list {
  id                  String               @id
  tenant_id           String
  user_id             String?
  template_id         String?
  status              String               @default("active")
  device_type         String?
  scanned_count       Int                  @default(0)
  committed_count     Int                  @default(0)
  duplicate_count     Int                  @default(0)
  metadata            Json?
  started_at          DateTime             @default(now()) @db.Timestamptz(6)
  completed_at        DateTime?            @db.Timestamptz(6)
  updated_at          DateTime             @default(now()) @db.Timestamptz(6)
  scan_results_list   scan_results_list[]
  scan_templates_list scan_templates_list? @relation(fields: [template_id], references: [id])
  tenants             tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([template_id])
  @@index([tenant_id])
  @@index([user_id])
}

model scan_templates_list {
  id                  String               @id
  tenant_id           String
  name                String
  default_category    String?
  default_price_cents Int?
  default_currency    String               @default("USD") @db.Char(3)
  default_visibility  String               @default("private")
  enrichment_rules    Json?
  scan_sessions_list  scan_sessions_list[]
  tenants             tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
}

model sku_billing_policies_list {
  id                   String    @id
  scope                String    @default("global")
  count_active_private Boolean?
  count_preorder       Boolean?
  count_zero_price     Boolean?
  require_image        Boolean?
  require_currency     Boolean?
  note                 String?
  updated_by           String?
  effective_from       DateTime?
  effective_to         DateTime?
  updated_at           DateTime  @default(now()) @db.Timestamptz(6)
  created_at           DateTime  @default(now()) @db.Timestamptz(6)
}

model sku_billing_policy_histories_list {
  id                   String    @id
  scope                String    @default("global")
  effective_from       DateTime
  effective_to         DateTime?
  count_active_private Boolean
  count_preorder       Boolean
  count_zero_price     Boolean
  require_image        Boolean
  require_currency     Boolean
  note                 String?
  updated_by           String
  created_at           DateTime  @default(now())
}

model sku_billing_policy_overrides_list {
  id                   String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  tenant_id            String
  count_active_private Boolean?
  count_preorder       Boolean?
  count_zero_price     Boolean?
  require_image        Boolean?
  require_currency     Boolean?
  note                 String?
  updated_by           String?
  updatedAt            DateTime @default(now()) @db.Timestamptz(6)
}

model square_integrations_list {
  id               String    @id
  tenant_id        String
  access_token     String
  refresh_token    String?
  merchant_id      String
  location_id      String?
  token_expires_at DateTime?
  scopes           String[]
  mode             String
  enabled          Boolean   @default(true)
  last_sync_at     DateTime?
  last_error       String?
  created_at       DateTime  @default(now())
  updated_at       DateTime  @default(now())
}

model square_product_mappings_list {
  id                       String    @id
  tenant_id                String
  integration_id           String
  inventory_item_id        String
  square_catalog_object_id String
  square_item_variation_id String?
  sync_status              String    @default("pending")
  last_synced_at           DateTime?
  sync_error               String?
  conflict_resolution      String?
  created_at               DateTime  @default(now())
  updated_at               DateTime  @default(now())
}

model square_sync_logs_list {
  id               String   @id
  tenant_id        String
  integration_id   String
  mapping_id       String?
  sync_type        String
  direction        String
  operation        String
  status           String
  error_message    String?
  error_code       String?
  request_payload  Json?
  response_payload Json?
  items_affected   Int      @default(0)
  duration_ms      Int?
  created_at       DateTime @default(now())
  updated_at       DateTime @default(now())
}

model store_rating_summary {
  tenant_id               String    @id
  rating_avg              Decimal?  @default(0.00) @db.Decimal(3, 2)
  rating_count            Int?      @default(0)
  rating_1_count          Int?      @default(0)
  rating_2_count          Int?      @default(0)
  rating_3_count          Int?      @default(0)
  rating_4_count          Int?      @default(0)
  rating_5_count          Int?      @default(0)
  helpful_count_total     Int?      @default(0)
  verified_purchase_count Int?      @default(0)
  last_review_at          DateTime? @db.Timestamp(6)
  updated_at              DateTime? @default(now()) @db.Timestamp(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model store_reviews {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String
  user_id           String
  rating            Int
  review_text       String?
  helpful_count     Int?      @default(0)
  verified_purchase Boolean?  @default(false)
  location_lat      Decimal?  @db.Decimal(10, 8)
  location_lng      Decimal?  @db.Decimal(11, 8)
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  updated_at        DateTime? @default(now()) @db.Timestamp(6)

  @@unique([tenant_id, user_id])
}

model storefront_mv_refresh_log {
  id                   Int       @id @default(autoincrement())
  refresh_started_at   DateTime? @default(now()) @db.Timestamptz(6)
  refresh_completed_at DateTime? @db.Timestamptz(6)
  refresh_duration_ms  Int?
  status               String?   @default("running")
  error_message        String?
}

model stripe_webhook_events {
  id           String   @id
  event_id     String
  event_type   String
  processed_at DateTime @default(now())
  created_at   DateTime @default(now())
}

model subscription_tiers_list {
  id                 String               @id
  tier_key           String               @unique
  name               String
  display_name       String
  description        String?
  price_monthly      Int
  max_skus           Int?
  max_locations      Int?
  tier_type          String               @default("individual")
  is_active          Boolean              @default(true)
  sort_order         Int                  @default(0)
  metadata           Json?
  created_at         DateTime             @default(now())
  updated_at         DateTime             @default(now())
  updated_by         String?
  created_by         String?
  tier_features_list tier_features_list[]
}

model sync_jobs {
  id         String   @id
  tenant_id  String
  target     String
  status     String   @default("queued")
  attempt    Int      @default(0)
  payload    Json
  last_error String?
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  tenants    tenants  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id, status, updated_at])
}

model tenant_business_profiles_list {
  tenant_id                  String               @id @unique
  business_name              String
  address_line1              String
  address_line2              String?
  city                       String
  state                      String?
  postal_code                String
  country_code               String               @db.Char(2)
  phone_number               String?
  email                      String?
  website                    String?
  contact_person             String?
  logo_url                   String?
  banner_url                 String?
  business_description       String?
  hours                      Json?
  social_links               Json?
  seo_tags                   Json?
  latitude                   Decimal?
  longitude                  Decimal?
  display_map                Boolean              @default(false)
  map_privacy_mode           String               @default("precise")
  gbp_category_id            String?
  gbp_category_name          String?
  gbp_category_last_mirrored DateTime?
  gbp_category_sync_status   String?
  updated_at                 DateTime
  gbp_categories_list        gbp_categories_list? @relation(fields: [gbp_category_id], references: [id])
  tenants                    tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([gbp_category_id])
}

model tenant_feature_flags_list {
  id          String   @id
  tenant_id   String
  flag        String
  enabled     Boolean  @default(false)
  rollout     String?
  updated_at  DateTime
  description String?

  @@unique([tenant_id, flag], map: "tenant_feature_flags_tenant_id_flag_unique")
}

model tenant_feature_overrides_list {
  id         String    @id
  tenant_id  String
  feature    String
  granted    Boolean   @default(true)
  reason     String?
  expires_at DateTime?
  granted_by String
  created_at DateTime  @default(now())
  updated_at DateTime
  tenants    tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, feature])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tenant_gbp_categories {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String    @db.VarChar(50)
  gbp_category_id String    @db.VarChar(50)
  category_type   String    @db.VarChar(20)
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, gbp_category_id, category_type], map: "tenant_gbp_categories_tenant_id_category_id_type_unique")
  @@index([tenant_id, category_type, gbp_category_id], map: "idx_tenant_gbp_categories_composite")
  @@index([gbp_category_id], map: "idx_tenant_gbp_categories_gbp_category_id")
  @@index([tenant_id], map: "idx_tenant_gbp_categories_tenant_id")
  @@index([category_type], map: "idx_tenant_gbp_categories_type")
}

model tenants {
  id                               String                             @unique
  name                             String
  created_at                       DateTime                           @default(now())
  region                           String                             @default("us-east-1")
  language                         String                             @default("en-US")
  currency                         String                             @default("USD")
  data_policy_accepted             Boolean                            @default(false)
  metadata                         Json?
  subscription_status              String?                            @default("trial")
  subscription_tier                String?                            @default("starter")
  trial_ends_at                    DateTime?
  subscription_ends_at             DateTime?
  stripe_customer_id               String?                            @unique
  stripe_subscription_id           String?                            @unique
  organization_id                  String?
  service_level                    String?                            @default("self_service")
  managed_services_active          Boolean                            @default(false)
  dedicated_manager                String?
  monthly_sku_quota                Int?
  skus_added_this_month            Int                                @default(0)
  google_business_access_token     String?
  google_business_refresh_token    String?
  google_business_token_expiry     DateTime?
  created_by                       String?
  location_status                  location_status                    @default(active)
  status_changed_at                DateTime?
  status_changed_by                String?
  reopening_date                   DateTime?
  closure_reason                   String?
  slug                             String?                            @unique
  google_sync_enabled              Boolean?                           @default(false)
  google_last_sync                 DateTime?                          @db.Timestamp(6)
  google_product_count             Int?                               @default(0)
  directory_visible                Boolean?                           @default(true)
  business_hours_list              business_hours_list?
  business_hours_special_list      business_hours_special_list[]
  category_mirror_runs             category_mirror_runs[]
  directory_featured_listings_list directory_featured_listings_list[]
  directory_settings_list          directory_settings_list?
  google_oauth_accounts_list       google_oauth_accounts_list[]
  inventory_items                  inventory_items[]
  invitations                      invitations[]
  photo_assets                     photo_assets[]
  product_performances             product_performances[]
  scan_results_list                scan_results_list[]
  scan_sessions_list               scan_sessions_list[]
  scan_templates_list              scan_templates_list[]
  sync_jobs                        sync_jobs[]
  tenant_business_profiles_list    tenant_business_profiles_list?
  tenant_feature_overrides_list    tenant_feature_overrides_list[]
  organizations_list               organizations_list?                @relation(fields: [organization_id], references: [id])
  user_tenants                     user_tenants[]

  @@index([directory_visible], map: "idx_tenant_directory_visible")
  @@index([google_sync_enabled, google_last_sync], map: "idx_tenant_google_sync")
  @@index([slug], map: "idx_tenant_slug")
  @@index([created_by], map: "tenant_created_by_idx")
  @@index([directory_visible], map: "tenant_directory_visible_idx")
  @@index([google_sync_enabled, google_last_sync], map: "tenant_google_sync_enabled_google_last_sync_idx")
  @@index([location_status], map: "tenant_location_status_idx")
  @@index([location_status], map: "tenant_locationstatus_idx")
  @@index([name], map: "tenant_name_idx")
  @@index([organization_id], map: "tenant_organizationid_idx")
  @@index([service_level], map: "tenant_servicelevel_idx")
  @@index([slug], map: "tenant_slug_idx")
  @@index([subscription_status], map: "tenant_subscriptionstatus_idx")
}

model tier_change_logs_list {
  id               String   @id
  entity_type      String
  entity_id        String
  action           String
  change_type      String
  before_state     Json?
  after_state      Json?
  changed_by       String
  changed_by_email String?
  reason           String?
  ip_address       String?
  user_agent       String?
  created_at       DateTime @default(now())
}

model tier_features_list {
  id                      String                  @id
  tier_id                 String
  feature_key             String
  feature_name            String
  is_enabled              Boolean                 @default(true)
  is_inherited            Boolean                 @default(false)
  metadata                Json?
  created_at              DateTime                @default(now())
  updated_at              DateTime                @default(now())
  subscription_tiers_list subscription_tiers_list @relation(fields: [tier_id], references: [id], onDelete: Cascade)

  @@unique([tier_id, feature_key])
}

model upgrade_requests {
  id             String    @id
  tenant_id      String
  business_name  String
  current_tier   String
  requested_tier String
  status         String    @default("new")
  notes          String?
  admin_notes    String?
  processed_by   String?
  processed_at   DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_behavior_simple {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id          String?   @db.Uuid
  session_id       String?   @db.VarChar(255)
  entity_type      String    @db.VarChar(20)
  entity_id        String    @db.Uuid
  entity_name      String?   @db.VarChar(255)
  context          Json?
  timestamp        DateTime? @default(now()) @db.Timestamptz(6)
  location_lat     Decimal?  @db.Decimal(10, 8)
  location_lng     Decimal?  @db.Decimal(11, 8)
  referrer         String?   @db.VarChar(500)
  user_agent       String?
  ip_address       String?   @db.Inet
  duration_seconds Int?
  page_type        String?   @db.VarChar(50)

  @@index([context], map: "idx_user_behavior_simple_context_gin", type: Gin)
  @@index([entity_type, entity_id, timestamp(sort: Desc)], map: "idx_user_behavior_simple_entity")
  @@index([page_type, timestamp(sort: Desc)], map: "idx_user_behavior_simple_page_type")
  @@index([timestamp(sort: Desc)], map: "idx_user_behavior_simple_timestamp")
  @@index([user_id, timestamp(sort: Desc)], map: "idx_user_behavior_simple_user_timestamp")
}

model user_sessions_list {
  id          String   @id
  user_id     String
  device_info String?
  ip_address  String?
  user_agent  String?
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  expires_at  DateTime
  users       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([expires_at])
  @@index([user_id])
}

model user_tenants {
  id         String           @id
  user_id    String
  tenant_id  String
  role       user_tenant_role @default(MEMBER)
  created_at DateTime         @default(now())
  updated_at DateTime
  tenants    tenants          @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  users      users            @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, tenant_id],map:"user_id_tenant_id_unique")
  @@index([tenant_id])
  @@index([user_id])
}

model users {
  id                               String                             @id
  email                            String                             @unique
  password_hash                    String
  first_name                       String?
  last_name                        String?
  role                             user_role                          @default(USER)
  email_verified                   Boolean                            @default(false)
  email_verification_token         String?
  password_reset_token             String?
  password_reset_expires           DateTime?
  last_login                       DateTime?
  is_active                        Boolean                            @default(true)
  created_at                       DateTime                           @default(now())
  updated_at                       DateTime
  directory_featured_listings_list directory_featured_listings_list[]
  invitations                      invitations[]
  user_sessions_list               user_sessions_list[]
  user_tenants                     user_tenants[]
}

enum action {
  create
  update
  delete
  sync
  policyApply
  oauthConnect
  oauthRefresh
}

enum actor_type {
  user
  system
  integration
}

enum availability_status {
  in_stock
  out_of_stock
  preorder
}

enum enrichment_status {
  NEEDS_ENRICHMENT
  PARTIALLY_ENRICHED
  PENDING
  COMPLETE
  FAILED
}

enum entity_status {
  pending
  active
  inactive
  closed
  archived
}

enum entity_type {
  inventory_item
  tenant
  policy
  oauth
  other
}

enum item_status {
  active
  inactive
  archived
  trashed
}

enum item_visibility {
  public
  private
}

enum job_status {
  queued
  processing
  success
  failed
}

enum location_status {
  pending
  active
  inactive
  closed
  archived
}

enum permission_action {
  tenant_create          @map("tenant.create")
  tenant_read            @map("tenant.read")
  tenant_update          @map("tenant.update")
  tenant_delete          @map("tenant.delete")
  tenant_manage_users    @map("tenant.manage_users")
  inventory_create       @map("inventory.create")
  inventory_read         @map("inventory.read")
  inventory_update       @map("inventory.update")
  inventory_delete       @map("inventory.delete")
  analytics_view         @map("analytics.view")
  admin_access_dashboard @map("admin.access_dashboard")
  admin_manage_settings  @map("admin.manage_settings")
}

enum product_condition {
  brand_new
  refurbished
  used
}

enum product_source {
  MANUAL
  BARCODE_SCAN
  BULK_UPLOAD
  API_IMPORT
  QUICK_START_WIZARD
  CLOVER_DEMO
}

enum sync_status {
  pending
  success
  error
}

enum user_role {
  PLATFORM_ADMIN
  PLATFORM_SUPPORT
  PLATFORM_VIEWER
  ADMIN
  OWNER
  USER
  TENANT_OWNER
  TENANT_ADMIN
  TENANT_MANAGER
  TENANT_MEMBER
  TENANT_VIEWER
}

enum user_tenant_role {
  OWNER
  ADMIN
  SUPPORT
  MEMBER
  VIEWER
}

/// Quick Start Product Caches
/// Stores AI-generated products for reuse across tenants
model quick_start_product_caches {
  id                    String    @id
  business_type         String
  category_name         String
  google_category_id    String?
  product_name          String
  price_cents           Int
  brand                 String?
  description           String?
  sku_pattern           String?
  
  // Image data
  image_url             String?
  thumbnail_url         String?
  image_width           Int?
  image_height          Int?
  image_bytes           Int?
  
  // Enhanced content
  enhanced_description  String?
  features              Json?
  specifications        Json?
  
  // Metadata
  generation_source     String    @default("ai")
  has_image             Boolean   @default(false)
  image_quality         String?
  usage_count           Int       @default(0)
  quality_score         Float     @default(0.0)
  
  created_at            DateTime  @default(now()) @db.Timestamptz(6)
  last_used_at          DateTime? @db.Timestamptz(6)
  
  @@unique([business_type, category_name, product_name], name: "unique_product_per_scenario")
  @@index([business_type, category_name], name: "idx_qspc_scenario")
  @@index([quality_score(sort: Desc)], name: "idx_qspc_quality")
  @@index([usage_count(sort: Desc)], name: "idx_qspc_usage")
  @@index([has_image], name: "idx_qspc_has_image")
  
  // Map to existing singular table name (created before naming standards)
  // TODO: Rename table to quick_start_product_caches in future migration
  @@map("quick_start_product_cache")
}
