generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model audit_log {
  id           String      @id
  tenant_id    String
  actor_id     String
  actor_type   actor_type
  diff         Json
  entity_id    String
  entity_type  entity_type
  ip           String?
  metadata     Json        @default("{}")
  occurred_at  DateTime    @default(now())
  pii_scrubbed Boolean     @default(true)
  request_id   String?
  user_agent   String?
  action       action

  @@index([tenant_id, occurred_at(sort: Desc)], map: "audit_log_tenant_id_occurred_at_sort_desc_idx")
}

model barcode_enrichment {
  id                  String   @id
  barcode             String   @unique
  name                String?
  brand               String?
  description         String?
  category_path       String[]
  price_cents         Int?
  image_url           String?
  image_thumbnail_url String?
  metadata            Json?
  source              String
  last_fetched_at     DateTime @default(now())
  fetch_count         Int      @default(1)
  created_at          DateTime @default(now())
  updated_at          DateTime
}

model barcode_lookup_log {
  id         String   @id
  tenant_id  String
  barcode    String
  provider   String?
  status     String   @default("success")
  response   Json?
  latency_ms Int?
  error      String?
  created_at DateTime @default(now())
}

model business_hours_list {
  id             String    @id
  tenant_id      String    @unique
  timezone       String    @default("America/New_York")
  periods        Json      @default("[]")
  source_hash    String?
  last_synced_at DateTime?
  sync_attempts  Int       @default(0)
  last_error     String?
  created_at     DateTime  @default(now())
  updated_at     DateTime
  tenants        tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
}

model business_hours_special_list {
  id             String    @id
  tenant_id      String
  date           DateTime  @db.Date
  isClosed       Boolean   @default(false)
  open           String?
  close          String?
  note           String?
  source_hash    String?
  last_synced_at DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime
  tenants        tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, date])
  @@index([tenant_id, date])
}

model category_mirror_runs {
  id           String    @id
  tenant_id    String?
  strategy     String
  dry_run      Boolean   @default(true)
  created      Int       @default(0)
  updated      Int       @default(0)
  deleted      Int       @default(0)
  skipped      Boolean   @default(false)
  reason       String?
  error        String?
  job_id       String?
  started_at   DateTime  @default(now())
  completed_at DateTime?
  tenants      tenants?  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id, strategy, started_at(sort: Desc)], map: "category_mirror_runs_tenant_id_strategy_started_at_sort_desc_")
}

model clover_category_mappings_list {
  id                       String                   @id @db.VarChar(255)
  integration_id           String                   @db.VarChar(255)
  clover_category_id       String                   @db.VarChar(255)
  clover_category_name     String                   @db.VarChar(255)
  clover_parent_id         String?                  @db.VarChar(255)
  rvp_category_id          String?                  @db.VarChar(255)
  rvp_category_name        String?                  @db.VarChar(255)
  sync_direction           String                   @default("bidirectional") @db.VarChar(50)
  mapping_status           String                   @default("pending") @db.VarChar(50)
  conflict_reason          String?
  last_synced_at           DateTime?                @db.Timestamptz(6)
  last_sync_status         String?                  @db.VarChar(50)
  created_at               DateTime                 @default(now()) @db.Timestamptz(6)
  updated_at               DateTime                 @db.Timestamptz(6)
  clover_integrations_list clover_integrations_list @relation(fields: [integration_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_clover_category_mappings_integration")

  @@index([integration_id, clover_category_id], map: "idx_clover_cat_map_integration_clover")
  @@index([integration_id, rvp_category_id], map: "idx_clover_cat_map_integration_rvp")
  @@index([mapping_status], map: "idx_clover_cat_map_status")
}

model clover_demo_snapshots_list {
  id                       String                   @id
  integration_id           String
  snapshot_data            Json
  item_count               Int
  created_at               DateTime                 @default(now())
  expires_at               DateTime
  clover_integrations_list clover_integrations_list @relation(fields: [integration_id], references: [id], onDelete: Cascade)
}

model clover_integrations_list {
  id                            String                          @id
  tenant_id                     String
  mode                          String                          @default("demo")
  status                        String                          @default("active")
  access_token                  String?
  refresh_token                 String?
  token_expires_at              DateTime?
  merchant_id                   String?
  demo_enabled_at               DateTime?
  demo_last_active_at           DateTime?
  production_enabled_at         DateTime?
  last_sync_at                  DateTime?
  last_sync_status              String?
  created_at                    DateTime                        @default(now())
  updated_at                    DateTime
  clover_category_mappings_list clover_category_mappings_list[]
  clover_demo_snapshots_list    clover_demo_snapshots_list[]
  clover_item_mappings_list     clover_item_mappings_list[]
  clover_sync_logs_list         clover_sync_logs_list[]
}

model clover_item_mappings_list {
  id                       String                   @id
  integration_id           String
  clover_item_id           String
  clover_item_name         String
  clover_sku               String?
  rvp_item_id              String?
  rvp_sku                  String?
  mapping_status           String                   @default("pending")
  conflict_reason          String?
  last_synced_at           DateTime?
  last_sync_status         String?
  created_at               DateTime                 @default(now())
  updated_at               DateTime
  clover_integrations_list clover_integrations_list @relation(fields: [integration_id], references: [id], onDelete: Cascade)
}

model clover_sync_logs_list {
  id                       String                   @id
  integration_id           String
  trace_id                 String
  operation                String
  status                   String
  items_processed          Int                      @default(0)
  items_succeeded          Int                      @default(0)
  items_failed             Int                      @default(0)
  error_message            String?
  error_details            Json?
  duration_ms              Int?
  started_at               DateTime                 @default(now())
  completed_at             DateTime?
  clover_integrations_list clover_integrations_list @relation(fields: [integration_id], references: [id], onDelete: Cascade)
}

model directory_category {
  id               String   @id
  tenantId         String
  name             String
  slug             String
  parentId         String?
  googleCategoryId String?
  isActive         Boolean  @default(true)
  sortOrder        Int      @default(0)
  createdAt        DateTime @default(now())
  updatedAt        DateTime
}

model directory_category_mv_refresh_log {
  id                   Int       @id @default(autoincrement())
  refresh_started_at   DateTime? @default(now()) @db.Timestamptz(6)
  refresh_completed_at DateTime? @db.Timestamptz(6)
  refresh_duration_ms  Int?
  status               String?   @default("running")
  error_message        String?
  records_affected     Int?
  trigger_source       String?

  @@index([refresh_started_at], map: "idx_mv_refresh_started_at")
  @@index([status], map: "idx_mv_refresh_status")
  @@index([trigger_source], map: "idx_mv_refresh_trigger_source")
}

model directory_featured_listings_list {
  id                 String   @id
  tenant_id          String
  featured_from      DateTime
  featured_until     DateTime
  placement_priority Int      @default(5)
  created_by         String?
  created_at         DateTime @default(now())
  users              users?   @relation(fields: [created_by], references: [id], onDelete: Cascade)
  tenants            tenants  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([placement_priority, featured_from(sort: Desc)])
  @@index([tenant_id, featured_until])
}

model directory_listing_categories {
  listing_id  String
  category_id String
  is_primary  Boolean?  @default(false)
  created_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@id([listing_id, category_id])
  @@index([category_id], map: "idx_directory_listing_categories_category")
  @@index([category_id, is_primary], map: "idx_directory_listing_categories_category_primary")
  @@index([listing_id], map: "idx_directory_listing_categories_listing")
}

model directory_listings_list {
  id                   String             @id
  tenant_id            String
  business_name        String?
  slug                 String?
  address              String?
  city                 String?
  state                String?
  zip_code             String?
  phone                String?
  email                String?
  website              String?
  latitude             Float?
  longitude            Float?
  primary_category     String?
  secondary_categories String[]
  logo_url             String?
  description          String?
  business_hours       Json?
  rating_avg           Float?             @default(0)
  rating_count         Int?               @default(0)
  product_count        Int?               @default(0)
  is_featured          Boolean?           @default(false)
  subscription_tier    String?            @default("trial")
  use_custom_website   Boolean?           @default(false)
  is_published         Boolean?           @default(true)
  created_at           DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?          @default(now()) @db.Timestamptz(6)
  keywords             String[]
  directory_photos     directory_photos[]

  @@index([is_published], map: "idx_directory_listings_is_published")
  @@index([keywords], map: "idx_directory_listings_keywords", type: Gin)
}

model directory_mv_refresh_log {
  id                   Int       @id @default(autoincrement())
  view_name            String
  refresh_started_at   DateTime  @default(now()) @db.Timestamptz(6)
  refresh_completed_at DateTime? @db.Timestamptz(6)
  refresh_duration_ms  Int?
  rows_affected        Int?
  triggered_by         String?
  error_message        String?
  status               String?   @default("in_progress")

  @@index([status, refresh_started_at(sort: Desc)], map: "idx_directory_mv_refresh_log_status")
  @@index([view_name, refresh_started_at(sort: Desc)], map: "idx_directory_mv_refresh_log_view_name")
}

model directory_photos {
  id                      String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id               String                  @db.VarChar(255)
  listing_id              String                  @db.VarChar(255)
  url                     String
  width                   Int?
  height                  Int?
  content_type            String?                 @db.VarChar(255)
  bytes                   Int?
  exif_removed            Boolean?                @default(false)
  captured_at             DateTime?               @db.Timestamptz(6)
  created_at              DateTime?               @default(now()) @db.Timestamptz(6)
  public_url              String?
  signed_url              String?
  position                Int?                    @default(0)
  alt                     String?
  caption                 String?
  directory_listings_list directory_listings_list @relation(fields: [listing_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_directory_photos_listing")
  tenants                 tenants                 @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_directory_photos_tenant")

  @@unique([listing_id, position], map: "directory_photos_listing_position_unique")
  @@index([listing_id], map: "idx_directory_photos_listing_id")
  @@index([tenant_id], map: "idx_directory_photos_tenant_id")
}

model directory_settings_list {
  id                   String    @id
  tenant_id            String    @unique
  is_published         Boolean   @default(false)
  seo_description      String?
  seo_keywords         String[]
  primary_category     String?
  secondary_categories String[]
  is_featured          Boolean   @default(false)
  featured_until       DateTime?
  slug                 String?   @unique
  created_at           DateTime  @default(now())
  updated_at           DateTime
  tenants              tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
}

model directory_support_notes_list {
  id         String   @id
  tenant_id  String
  note       String
  created_by String
  created_at DateTime @default(now())
}

model email_configuration_list {
  id         String   @id
  category   String   @unique
  email      String
  updated_at DateTime
  updated_by String?
}

model feed_push_jobs_list {
  id            String     @id
  tenant_id     String
  sku           String?
  job_status    job_status @default(queued)
  retry_count   Int        @default(0)
  max_retries   Int        @default(5)
  last_attempt  DateTime?
  next_retry    DateTime?
  error_message String?
  error_code    String?
  payload       Json?
  result        Json?
  created_at    DateTime   @default(now()) @db.Timestamptz(6)
  updated_at    DateTime   @db.Timestamptz(6)
  completed_at  DateTime?  @db.Timestamptz(6)
}

model gbp_attributes {
  id           String    @id @db.VarChar(50)
  tenant_id    String    @db.VarChar(50)
  attribute_id String    @db.VarChar(100)
  value_type   String?   @db.VarChar(20)
  value_bool   Boolean?
  value_enum   String?   @db.VarChar(100)
  value_url    String?
  is_synced    Boolean?  @default(false)
  synced_at    DateTime? @db.Timestamp(6)
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at   DateTime? @default(now()) @db.Timestamp(6)
  tenants      tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_gbp_attributes_tenant_id")

  @@unique([tenant_id, attribute_id], map: "uq_gbp_attributes_tenant_attribute")
  @@index([is_synced], map: "idx_gbp_attributes_is_synced")
  @@index([tenant_id], map: "idx_gbp_attributes_tenant_id")
}

model gbp_categories_list {
  id                            String                          @id
  name                          String                          @unique
  display_name                  String
  is_active                     Boolean                         @default(true)
  created_at                    DateTime                        @default(now()) @db.Timestamptz(6)
  updated_at                    DateTime                        @db.Timestamptz(6)
  tenant_business_profiles_list tenant_business_profiles_list[]
}

model gbp_category_mappings {
  gbp_category_id           String    @id
  gbp_category_name         String
  gbp_category_display_name String?
  platform_category_id      String?
  is_active                 Boolean?  @default(true)
  mapping_confidence        String?
  mapping_notes             String?
  tenant_count              Int?      @default(0)
  last_used_at              DateTime? @db.Timestamptz(6)
  created_at                DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                DateTime? @default(now()) @db.Timestamptz(6)
  created_by                String?
  updated_by                String?

  @@index([mapping_confidence], map: "idx_gbp_category_mappings_confidence")
  @@index([tenant_count(sort: Desc), last_used_at(sort: Desc)], map: "idx_gbp_category_mappings_usage")
}

model gbp_insights_daily_list {
  id                 String             @id
  location_id        String
  date               DateTime           @db.Date
  views_search       Int                @default(0)
  views_maps         Int                @default(0)
  actions_website    Int                @default(0)
  actions_phone      Int                @default(0)
  actions_directions Int                @default(0)
  photos_count       Int                @default(0)
  created_at         DateTime           @default(now()) @db.Timestamptz(6)
  gbp_locations_list gbp_locations_list @relation(fields: [location_id], references: [id], onDelete: Cascade)

  @@unique([location_id, date])
}

model gbp_listing_categories {
  listing_id      String
  gbp_category_id String
  is_primary      Boolean  @default(false)
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  updated_at      DateTime @default(now()) @db.Timestamptz(6)

  @@id([listing_id, gbp_category_id])
  @@index([gbp_category_id], map: "idx_gbp_listing_categories_category")
  @@index([gbp_category_id, is_primary], map: "idx_gbp_listing_categories_category_primary")
  @@index([listing_id], map: "idx_gbp_listing_categories_listing")
}

model gbp_locations_list {
  id                         String                     @id
  account_id                 String
  location_id                String
  location_name              String
  store_code                 String?
  address                    String?
  phone_number               String?
  website_url                String?
  category                   String?
  is_verified                Boolean?                   @default(false)
  is_published               Boolean?                   @default(false)
  last_fetched_at            DateTime?                  @db.Timestamptz(6)
  created_at                 DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime                   @db.Timestamptz(6)
  gbp_insights_daily_list    gbp_insights_daily_list[]
  google_oauth_accounts_list google_oauth_accounts_list @relation(fields: [account_id], references: [id], onDelete: Cascade)

  @@unique([account_id, location_id])
}

model gbp_media {
  id              String    @id @db.VarChar(50)
  tenant_id       String    @db.VarChar(50)
  google_media_id String?   @db.VarChar(255)
  media_format    String?   @default("photo") @db.VarChar(20)
  category        String?   @default("additional") @db.VarChar(50)
  source_url      String?
  google_url      String?
  description     String?
  is_active       Boolean?  @default(true)
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  updated_at      DateTime? @default(now()) @db.Timestamp(6)
  tenants         tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_gbp_media_tenant_id")

  @@index([category], map: "idx_gbp_media_category")
  @@index([is_active], map: "idx_gbp_media_is_active")
  @@index([tenant_id], map: "idx_gbp_media_tenant_id")
}

model gbp_posts {
  id                  String    @id @db.VarChar(50)
  tenant_id           String    @db.VarChar(50)
  google_post_id      String?   @db.VarChar(255)
  summary             String
  topic_type          String?   @default("standard") @db.VarChar(50)
  call_to_action_type String?   @db.VarChar(50)
  call_to_action_url  String?
  media_url           String?
  event_title         String?   @db.VarChar(255)
  event_start_date    DateTime? @db.Timestamp(6)
  event_end_date      DateTime? @db.Timestamp(6)
  offer_coupon_code   String?   @db.VarChar(100)
  offer_redeem_url    String?
  offer_terms         String?
  state               String?   @default("live") @db.VarChar(50)
  google_create_time  DateTime? @db.Timestamp(6)
  google_update_time  DateTime? @db.Timestamp(6)
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  updated_at          DateTime? @default(now()) @db.Timestamp(6)
  tenants             tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_gbp_posts_tenant_id")

  @@index([google_post_id], map: "idx_gbp_posts_google_post_id")
  @@index([tenant_id], map: "idx_gbp_posts_tenant_id")
  @@index([topic_type], map: "idx_gbp_posts_topic_type")
}

model gbp_reviews {
  id                 String    @id @db.VarChar(50)
  tenant_id          String    @db.VarChar(50)
  google_review_id   String?   @unique(map: "uq_gbp_reviews_google_review_id") @db.VarChar(255)
  reviewer_name      String?   @db.VarChar(255)
  reviewer_photo_url String?
  star_rating        String?   @db.VarChar(10)
  comment            String?
  review_reply       String?
  reply_update_time  DateTime? @db.Timestamp(6)
  google_create_time DateTime? @db.Timestamp(6)
  google_update_time DateTime? @db.Timestamp(6)
  is_replied         Boolean?  @default(false)
  created_at         DateTime? @default(now()) @db.Timestamp(6)
  updated_at         DateTime? @default(now()) @db.Timestamp(6)
  tenants            tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_gbp_reviews_tenant_id")

  @@index([google_review_id], map: "idx_gbp_reviews_google_review_id")
  @@index([is_replied], map: "idx_gbp_reviews_is_replied")
  @@index([star_rating], map: "idx_gbp_reviews_star_rating")
  @@index([tenant_id], map: "idx_gbp_reviews_tenant_id")
}

model gbp_sync_history {
  id                  String   @id
  tenant_id           String
  field_category      String
  field_name          String?
  sync_direction      String
  sync_status         String
  local_value_before  String?
  google_value_before String?
  value_after         String?
  error_message       String?
  error_code          String?
  initiated_by        String?
  created_at          DateTime @default(now()) @db.Timestamptz(6)
  tenants             tenants  @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([field_category], map: "idx_gbp_sync_history_category")
  @@index([created_at(sort: Desc)], map: "idx_gbp_sync_history_created_at")
  @@index([sync_status], map: "idx_gbp_sync_history_status")
  @@index([tenant_id], map: "idx_gbp_sync_history_tenant_id")
}

model gbp_sync_tracking {
  id                   String    @id
  tenant_id            String
  field_category       String
  field_name           String
  local_value_hash     String?
  google_value_hash    String?
  local_updated_at     DateTime? @db.Timestamptz(6)
  google_updated_at    DateTime? @db.Timestamptz(6)
  last_sync_at         DateTime? @db.Timestamptz(6)
  last_sync_direction  String?
  sync_status          String    @default("unknown")
  conflict_detected_at DateTime? @db.Timestamptz(6)
  conflict_resolution  String?
  created_at           DateTime  @default(now()) @db.Timestamptz(6)
  updated_at           DateTime  @default(now()) @db.Timestamptz(6)
  tenants              tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, field_category, field_name], map: "uq_gbp_sync_tracking_tenant_field")
  @@index([field_category], map: "idx_gbp_sync_tracking_category")
  @@index([sync_status], map: "idx_gbp_sync_tracking_status")
  @@index([tenant_id], map: "idx_gbp_sync_tracking_tenant_id")
}

model google_merchant_links_list {
  id                         String                     @id
  account_id                 String
  merchant_id                String
  merchant_name              String?
  website_url                String?
  is_active                  Boolean                    @default(true)
  last_sync_at               DateTime?                  @db.Timestamptz(6)
  sync_status                String?                    @default("pending")
  sync_error                 String?
  created_at                 DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime                   @db.Timestamptz(6)
  pickup_only                Boolean                    @default(false)
  pickup_method              String                     @default("buy")
  pickup_sla                 String                     @default("same day")
  fulfillment_mode           String                     @default("standard")
  google_oauth_accounts_list google_oauth_accounts_list @relation(fields: [account_id], references: [id], onDelete: Cascade)

  @@index([account_id])
}

model google_oauth_accounts_list {
  id                         String                       @id
  tenant_id                  String
  google_account_id          String
  email                      String
  display_name               String?
  profile_picture_url        String?
  scopes                     String[]
  created_at                 DateTime                     @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime                     @db.Timestamptz(6)
  gbp_locations_list         gbp_locations_list[]
  google_merchant_links_list google_merchant_links_list[]
  tenants                    tenants                      @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  google_oauth_tokens_list   google_oauth_tokens_list?

  @@unique([tenant_id, google_account_id])
  @@index([tenant_id])
}

model google_oauth_tokens_list {
  id                         String                     @id
  account_id                 String                     @unique
  access_token_encrypted     String
  refresh_token_encrypted    String
  token_type                 String                     @default("Bearer")
  expires_at                 DateTime                   @db.Timestamptz(6)
  scopes                     String[]
  created_at                 DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime                   @db.Timestamptz(6)
  google_oauth_accounts_list google_oauth_accounts_list @relation(fields: [account_id], references: [id], onDelete: Cascade)
}

model google_taxonomy_list {
  id            String   @id
  category_id   String   @unique
  category_path String
  parent_id     String?
  level         Int
  is_active     Boolean  @default(true)
  version       String   @default("2024-09")
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @db.Timestamptz(6)
}

model inventory_items {
  id                      String                   @id
  tenant_id               String
  sku                     String
  name                    String
  price_cents             Int
  stock                   Int                      @default(0)
  image_url               String?
  metadata                Json?
  created_at              DateTime                 @default(now())
  updated_at              DateTime
  marketing_description   String?
  image_gallery           String[]                 @default([])
  custom_cta              Json?
  social_links            Json?
  custom_branding         Json?
  custom_sections         Json[]                   @default([])
  landing_page_theme      String?                  @default("default")
  audit_log_id            String?
  availability            availability_status      @default(in_stock)
  brand                   String
  category_path           String[]                 @default([])
  directory_category_id   String?
  condition               product_condition?       @default(brand_new)
  currency                String                   @default("USD") @db.Char(3)
  description             String?
  eligibility_reason      String?
  gtin                    String?
  item_status             item_status?             @default(active)
  location_id             String?
  merchant_name           String?
  mpn                     String?
  price                   Decimal                  @db.Decimal(12, 2)
  quantity                Int?
  search_tsv              Unsupported("tsvector")?
  sync_status             sync_status?             @default(pending)
  synced_at               DateTime?                @db.Timestamptz(6)
  title                   String
  visibility              item_visibility?         @default(public)
  manufacturer            String?
  source                  product_source           @default(MANUAL)
  enrichment_status       enrichment_status        @default(COMPLETE)
  enriched_at             DateTime?
  enriched_by             String?
  enriched_from_barcode   String?
  missing_images          Boolean                  @default(false)
  missing_description     Boolean                  @default(false)
  missing_specs           Boolean                  @default(false)
  missing_brand           Boolean                  @default(false)
  sale_price_cents        Int?
  payment_gateway_type    String?                  @db.VarChar(50)
  payment_gateway_id      String?                  @db.VarChar(255)
  product_type            product_type             @default(physical)
  digital_delivery_method digital_delivery_method?
  digital_assets          Json?
  access_duration_days    Int?
  download_limit          Int?
  license_type            license_type?
  has_variants            Boolean?                 @default(false)
  is_featured             Boolean?                 @default(false) @map("is_featured")
  featured_at             DateTime?                @map("featured_at") @db.Timestamp(6)
  featured_until          DateTime?                @map("featured_until") @db.Timestamp(6)
  featured_priority       Int?                     @default(0) @map("featured_priority")
  featured_type           String?                  @default("store_selection")
  digital_access_grants   digital_access_grants[]
  featured_products       featured_products[]
  tenant_payment_gateways tenant_payment_gateways? @relation(fields: [payment_gateway_id], references: [id], onUpdate: NoAction, map: "fk_inventory_items_payment_gateway")
  tenants                 tenants                  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  order_items             order_items[]
  photo_assets            photo_assets[]
  product_performances    product_performances[]
  product_variants        product_variants[]
  shopping_cart_items     shopping_cart_items[]
  store_reviews           store_reviews[]

  @@unique([tenant_id, sku])
  @@index([source])
  @@index([tenant_id, enrichment_status])
  @@index([tenant_id, updated_at])
  @@index([payment_gateway_id], map: "idx_inventory_items_payment_gateway_id")
  @@index([payment_gateway_type], map: "idx_inventory_items_payment_gateway_type")
  @@index([product_type], map: "idx_inventory_items_product_type")
  @@index([tenant_id, featured_type, is_featured], map: "idx_inventory_items_featured_type")
}

model invitations {
  id          String           @id @default(dbgenerated("gen_random_uuid()"))
  email       String           @unique
  token       String           @unique @default(dbgenerated("encode(gen_random_bytes(32), 'hex'::text)"))
  tenant_id   String
  role        user_tenant_role @default(MEMBER)
  invited_by  String
  expires_at  DateTime         @default(dbgenerated("(now() + '7 days'::interval)"))
  accepted_at DateTime?
  created_at  DateTime         @default(now())
  updated_at  DateTime         @default(now())
  users       users            @relation(fields: [invited_by], references: [id], onDelete: Cascade)
  tenants     tenants          @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([expires_at])
  @@index([tenant_id])
}

model location_status_logs {
  id             Int             @id @default(autoincrement())
  tenant_id      String          @db.VarChar(255)
  old_status     location_status
  new_status     location_status
  changed_by     String?         @db.VarChar(255)
  reason         String?
  reopening_date DateTime?       @db.Timestamp(6)
  created_at     DateTime        @default(now()) @db.Timestamp(6)
  updated_at     DateTime        @default(now()) @db.Timestamp(6)
  tenants        tenants         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_location_status_logs_created_at")
  @@index([tenant_id], map: "idx_location_status_logs_tenant_id")
}

model manual_migrations {
  id             Int       @id @default(autoincrement())
  migration_name String    @unique
  description    String?
  executed_at    DateTime? @default(now()) @db.Timestamptz(6)
  executed_by    String?
  rollback_sql   String?
  status         String?   @default("pending")

  @@index([status, executed_at(sort: Desc)], map: "idx_manual_migrations_status")
}

model oauth_integrations {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String?
  provider      String
  access_token  String
  refresh_token String?
  scopes        String[]  @default([])
  expiresAt     DateTime? @db.Timestamptz(6)
  isActive      Boolean?  @default(true)
  metadata      Json?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)
}

model organization_requests_list {
  id              String    @id
  tenant_id       String
  organization_id String
  requested_by    String
  status          String    @default("pending")
  request_type    String    @default("join")
  estimated_cost  Float?
  cost_currency   String?   @default("USD")
  notes           String?
  admin_notes     String?
  cost_agreed     Boolean   @default(false)
  cost_agreed_at  DateTime?
  processed_by    String?
  processed_at    DateTime?
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  updated_at      DateTime  @db.Timestamptz(6)
}

model organizations_list {
  id                     String    @id
  name                   String
  owner_id               String
  created_at             DateTime  @default(now())
  updated_at             DateTime
  subscription_tier      String?   @default("chain_starter")
  subscription_status    String?   @default("trial")
  trial_ends_at          DateTime?
  subscription_ends_at   DateTime?
  stripe_customer_id     String?
  stripe_subscription_id String?
  max_locations          Int       @default(5)
  max_total_skus         Int       @default(2500)
  metadata               Json?
  tenants                tenants[]
}

model outreach_feedback_list {
  id         String   @id
  tenant_id  String?
  user_id    String?
  feedback   Json
  score      Int
  category   String?
  context    String?
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @db.Timestamptz(6)
}

model permission_audit_logs_list {
  id         String   @id
  role       String
  action     String
  old_value  Boolean?
  new_value  Boolean
  changed_by String
  changed_at DateTime @default(now()) @db.Timestamptz(6)
  reason     String?
}

model permission_matrix_list {
  id          String            @id
  role        String
  action      permission_action
  allowed     Boolean           @default(false)
  description String?
  created_at  DateTime          @default(now()) @db.Timestamptz(6)
  updated_at  DateTime          @db.Timestamptz(6)
}

model photo_assets {
  id               String            @id
  tenantId         String
  inventoryItemId  String
  url              String
  width            Int?
  height           Int?
  contentType      String?
  bytes            Int?
  exifRemoved      Boolean           @default(false)
  capturedAt       DateTime?         @db.Timestamptz(6)
  createdAt        DateTime          @default(now()) @db.Timestamptz(6)
  publicUrl        String?
  signedUrl        String?
  position         Int               @default(0)
  alt              String?
  caption          String?
  variant_id       String?
  product_variants product_variants? @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_photo_assets_variant_id")
  inventory_items  inventory_items   @relation(fields: [inventoryItemId], references: [id], onDelete: Cascade)
  tenants          tenants           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([inventoryItemId, position], map: "photo_assets_inventory_item_id_position_unique")
  @@index([inventoryItemId], map: "idx_photo_assets_inventory_item_id")
  @@index([tenantId], map: "idx_photo_assets_tenant_id")
}

model platform_categories {
  id                 String    @id @default(dbgenerated("('cat_'::text || gen_random_uuid())"))
  name               String
  slug               String    @unique
  description        String?
  google_category_id String    @unique
  parent_id          String?
  level              Int?      @default(0)
  icon_emoji         String?
  sort_order         Int?      @default(0)
  is_active          Boolean?  @default(true)
  is_featured        Boolean?  @default(false)
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @db.Timestamptz(6)
  gcid               String?

  @@index([google_category_id], map: "idx_platform_categories_google_id")
  @@index([parent_id], map: "idx_platform_categories_parent")
  @@index([slug], map: "idx_platform_categories_slug")
  @@index([sort_order, name], map: "idx_platform_categories_sort")
}

model platform_feature_flags_list {
  id                    String   @id
  flag                  String   @unique
  enabled               Boolean  @default(false)
  description           String?
  rollout               String?
  allow_tenant_override Boolean  @default(false)
  updated_at            DateTime @db.Timestamptz(6)
  created_at            DateTime @db.Timestamptz(6)
}

model platform_settings_list {
  id                    Int      @id @default(1)
  platform_name         String?
  platform_description  String?
  logo_url              String?
  favicon_url           String?
  created_at            DateTime @default(now()) @db.Timestamptz(6)
  updated_at            DateTime @db.Timestamptz(6)
  rate_limiting_enabled Boolean? @default(true)
}

model product_performances {
  id               String          @id
  item_id          String
  tenant_id        String
  date             DateTime        @db.Date
  approval_status  String?
  rejection_reason String?
  impressions      Int             @default(0)
  clicks           Int             @default(0)
  ctr              Decimal         @default(0) @db.Decimal(5, 2)
  conversions      Int             @default(0)
  revenue          Decimal         @default(0) @db.Decimal(12, 2)
  visibility_score Int             @default(0)
  search_rank      Int?
  last_updated     DateTime        @default(now()) @db.Timestamptz(6)
  created_at       DateTime        @default(now()) @db.Timestamptz(6)
  inventory_items  inventory_items @relation(fields: [item_id], references: [id], onDelete: Cascade)
  tenants          tenants         @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([item_id, date], map: "product_performance_item_id_date_unique")
  @@index([tenant_id, date(sort: Desc)], map: "product_performance_tenant_id_date_sort_desc_idx")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model quick_start_product_cache {
  id                   String    @id
  business_type        String
  category_name        String
  google_category_id   String?
  product_name         String
  price_cents          Int
  brand                String?
  description          String?
  sku_pattern          String?
  generation_source    String    @default("ai")
  usage_count          Int       @default(0)
  quality_score        Float?    @default(0.0) @db.Real
  created_at           DateTime  @default(now()) @db.Timestamp(6)
  last_used_at         DateTime? @db.Timestamp(6)
  image_url            String?
  thumbnail_url        String?
  image_width          Int?
  image_height         Int?
  image_bytes          Int?
  enhanced_description String?
  features             Json?
  specifications       Json?
  has_image            Boolean?  @default(false)
  image_quality        String?

  @@unique([business_type, category_name, product_name], map: "unique_product_per_scenario")
  @@index([quality_score(sort: Desc)], map: "idx_qspc_quality")
  @@index([business_type, category_name], map: "idx_qspc_scenario")
  @@index([usage_count(sort: Desc)], map: "idx_qspc_usage")
}

model review_helpful_votes {
  id         String   @id
  review_id  String
  user_id    String
  is_helpful Boolean
  created_at DateTime @default(now())

  @@unique([review_id, user_id])
}

model scan_results_list {
  id                 String             @id
  tenant_id          String
  session_id         String
  barcode            String
  sku                String?
  raw_payload        Json?
  status             String             @default("new")
  enrichment         Json?
  validation         Json?
  duplicate_of       String?
  error              String?
  created_at         DateTime           @default(now()) @db.Timestamptz(6)
  updated_at         DateTime           @default(now()) @db.Timestamptz(6)
  scan_sessions_list scan_sessions_list @relation(fields: [session_id], references: [id], onDelete: Cascade)
  tenants            tenants            @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([barcode])
  @@index([session_id])
  @@index([tenant_id])
}

model scan_sessions_list {
  id                  String               @id
  tenant_id           String
  user_id             String?
  template_id         String?
  status              String               @default("active")
  device_type         String?
  scanned_count       Int                  @default(0)
  committed_count     Int                  @default(0)
  duplicate_count     Int                  @default(0)
  metadata            Json?
  started_at          DateTime             @default(now()) @db.Timestamptz(6)
  completed_at        DateTime?            @db.Timestamptz(6)
  updated_at          DateTime             @default(now()) @db.Timestamptz(6)
  scan_results_list   scan_results_list[]
  scan_templates_list scan_templates_list? @relation(fields: [template_id], references: [id])
  tenants             tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([template_id])
  @@index([tenant_id])
  @@index([user_id])
}

model scan_templates_list {
  id                  String               @id
  tenant_id           String
  name                String
  default_category    String?
  default_price_cents Int?
  default_currency    String               @default("USD") @db.Char(3)
  default_visibility  String               @default("private")
  enrichment_rules    Json?
  scan_sessions_list  scan_sessions_list[]
  tenants             tenants              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id])
}

model sku_billing_policies_list {
  id                   String    @id
  scope                String    @default("global")
  count_active_private Boolean?
  count_preorder       Boolean?
  count_zero_price     Boolean?
  require_image        Boolean?
  require_currency     Boolean?
  note                 String?
  updated_by           String?
  effective_from       DateTime?
  effective_to         DateTime?
  updated_at           DateTime  @default(now()) @db.Timestamptz(6)
  created_at           DateTime  @default(now()) @db.Timestamptz(6)
}

model sku_billing_policy_histories_list {
  id                   String    @id
  scope                String    @default("global")
  effective_from       DateTime
  effective_to         DateTime?
  count_active_private Boolean
  count_preorder       Boolean
  count_zero_price     Boolean
  require_image        Boolean
  require_currency     Boolean
  note                 String?
  updated_by           String
  created_at           DateTime  @default(now())
}

model sku_billing_policy_overrides_list {
  id                   String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  tenant_id            String
  count_active_private Boolean?
  count_preorder       Boolean?
  count_zero_price     Boolean?
  require_image        Boolean?
  require_currency     Boolean?
  note                 String?
  updated_by           String?
  updatedAt            DateTime @default(now()) @db.Timestamptz(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

model square_integrations_list {
  id               String    @id
  tenant_id        String
  access_token     String
  refresh_token    String?
  merchant_id      String
  location_id      String?
  token_expires_at DateTime?
  scopes           String[]
  mode             String
  enabled          Boolean   @default(true)
  last_sync_at     DateTime?
  last_error       String?
  created_at       DateTime  @default(now())
  updated_at       DateTime  @default(now())
}

model square_product_mappings_list {
  id                       String    @id
  tenant_id                String
  integration_id           String
  inventory_item_id        String
  square_catalog_object_id String
  square_item_variation_id String?
  sync_status              String    @default("pending")
  last_synced_at           DateTime?
  sync_error               String?
  conflict_resolution      String?
  created_at               DateTime  @default(now())
  updated_at               DateTime  @default(now())
}

model square_sync_logs_list {
  id               String   @id
  tenant_id        String
  integration_id   String
  mapping_id       String?
  sync_type        String
  direction        String
  operation        String
  status           String
  error_message    String?
  error_code       String?
  request_payload  Json?
  response_payload Json?
  items_affected   Int      @default(0)
  duration_ms      Int?
  created_at       DateTime @default(now())
  updated_at       DateTime @default(now())
}

model store_rating_summary {
  tenant_id               String    @id
  rating_avg              Decimal?  @default(0.00) @db.Decimal(3, 2)
  rating_count            Int?      @default(0)
  rating_1_count          Int?      @default(0)
  rating_2_count          Int?      @default(0)
  rating_3_count          Int?      @default(0)
  rating_4_count          Int?      @default(0)
  rating_5_count          Int?      @default(0)
  helpful_count_total     Int?      @default(0)
  verified_purchase_count Int?      @default(0)
  last_review_at          DateTime? @db.Timestamp(6)
  updated_at              DateTime? @default(now()) @db.Timestamp(6)
}

model store_reviews {
  id                String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String
  user_id           String?
  rating            Int
  review_text       String?
  helpful_count     Int?             @default(0)
  verified_purchase Boolean?         @default(false)
  location_lat      Decimal?         @db.Decimal(10, 8)
  location_lng      Decimal?         @db.Decimal(11, 8)
  created_at        DateTime?        @default(now()) @db.Timestamp(6)
  updated_at        DateTime?        @default(now()) @db.Timestamp(6)
  session_id        String?
  approval_status   review_status?   @default(pending)
  approved_by       String?
  approved_at       DateTime?        @db.Timestamptz(6)
  rejection_reason  String?
  product_id        String?
  inventory_items   inventory_items? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([tenant_id, user_id, product_id], map: "store_reviews_unique_user_tenant_product")
  @@index([approval_status], map: "idx_store_reviews_approval_status")
  @@index([product_id], map: "idx_store_reviews_product_id")
  @@index([session_id], map: "idx_store_reviews_session_id")
  @@index([tenant_id, approval_status], map: "idx_store_reviews_tenant_approval_status")
}

model storefront_mv_refresh_log {
  id                   Int       @id @default(autoincrement())
  refresh_started_at   DateTime? @default(now()) @db.Timestamptz(6)
  refresh_completed_at DateTime? @db.Timestamptz(6)
  refresh_duration_ms  Int?
  status               String?   @default("running")
  error_message        String?
}

model stripe_webhook_events {
  id           String   @id
  event_id     String
  event_type   String
  processed_at DateTime @default(now())
  created_at   DateTime @default(now())
}

model subscription_tiers_list {
  id                 String               @id
  tier_key           String               @unique
  name               String
  display_name       String
  description        String?
  price_monthly      Int
  max_skus           Int?
  max_locations      Int?
  tier_type          String               @default("individual")
  is_active          Boolean              @default(true)
  sort_order         Int                  @default(0)
  metadata           Json?
  created_at         DateTime             @default(now())
  updated_at         DateTime             @default(now())
  updated_by         String?
  created_by         String?
  tier_features_list tier_features_list[]
}

model sync_jobs {
  id         String   @id
  tenant_id  String
  target     String
  status     String   @default("queued")
  attempt    Int      @default(0)
  payload    Json
  last_error String?
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
  tenants    tenants  @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id, status, updated_at])
}

model tenant_business_profiles_list {
  tenant_id                  String                    @id @unique
  business_name              String
  address_line1              String
  address_line2              String?
  city                       String
  state                      String?
  postal_code                String
  country_code               String                    @db.Char(2)
  phone_number               String?
  email                      String?
  website                    String?
  contact_person             String?
  logo_url                   String?
  banner_url                 String?
  business_description       String?
  hours                      Json?
  social_links               Json?
  seo_tags                   Json?
  latitude                   Decimal?
  longitude                  Decimal?
  display_map                Boolean                   @default(false)
  map_privacy_mode           String                    @default("precise")
  gbp_category_id            String?
  gbp_category_name          String?
  gbp_category_last_mirrored DateTime?
  gbp_category_sync_status   String?
  updated_at                 DateTime
  geolocation                Unsupported("geography")?
  gbp_categories_list        gbp_categories_list?      @relation(fields: [gbp_category_id], references: [id])
  tenants                    tenants                   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([geolocation], map: "idx_tenant_business_profiles_geolocation", type: Gist)
  @@index([gbp_category_id])
}

model tenant_feature_flags_list {
  id          String   @id
  tenant_id   String
  flag        String
  enabled     Boolean  @default(false)
  rollout     String?
  updated_at  DateTime
  description String?

  @@unique([tenant_id, flag], map: "tenant_feature_flags_tenant_id_flag_unique")
}

model tenant_feature_overrides_list {
  id         String    @id
  tenant_id  String
  feature    String
  granted    Boolean   @default(true)
  reason     String?
  expires_at DateTime?
  granted_by String
  created_at DateTime  @default(now())
  updated_at DateTime
  tenants    tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, feature])
}

model tenant_gbp_categories {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String    @db.VarChar(50)
  gbp_category_id String    @db.VarChar(50)
  category_type   String    @db.VarChar(20)
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, gbp_category_id, category_type], map: "tenant_gbp_categories_tenant_id_category_id_type_unique")
  @@index([tenant_id, category_type, gbp_category_id], map: "idx_tenant_gbp_categories_composite")
  @@index([gbp_category_id], map: "idx_tenant_gbp_categories_gbp_category_id")
  @@index([tenant_id], map: "idx_tenant_gbp_categories_tenant_id")
  @@index([category_type], map: "idx_tenant_gbp_categories_type")
}

model tenants {
  id                               String                             @unique
  name                             String
  created_at                       DateTime                           @default(now())
  region                           String                             @default("us-east-1")
  language                         String                             @default("en-US")
  currency                         String                             @default("USD")
  data_policy_accepted             Boolean                            @default(false)
  metadata                         Json?
  subscription_status              String?                            @default("trial")
  subscription_tier                String?                            @default("starter")
  trial_ends_at                    DateTime?
  subscription_ends_at             DateTime?
  stripe_customer_id               String?                            @unique
  stripe_subscription_id           String?                            @unique
  organization_id                  String?
  service_level                    String?                            @default("self_service")
  managed_services_active          Boolean                            @default(false)
  dedicated_manager                String?
  monthly_sku_quota                Int?
  skus_added_this_month            Int                                @default(0)
  google_business_access_token     String?
  google_business_refresh_token    String?
  google_business_token_expiry     DateTime?
  created_by                       String?
  location_status                  location_status                    @default(active)
  status_changed_at                DateTime?
  status_changed_by                String?
  reopening_date                   DateTime?
  closure_reason                   String?
  slug                             String?                            @unique
  google_sync_enabled              Boolean?                           @default(false)
  google_last_sync                 DateTime?                          @db.Timestamp(6)
  google_product_count             Int?                               @default(0)
  directory_visible                Boolean?                           @default(true)
  subdomain                        String?                            @unique
  platform_fee_percentage          Decimal?                           @default(0.00) @db.Decimal(5, 2)
  platform_fee_fixed_cents         Int?                               @default(0)
  platform_fee_waived              Boolean?                           @default(false)
  platform_fee_waived_reason       String?
  platform_fee_waived_until        DateTime?                          @db.Timestamp(6)
  business_hours_list              business_hours_list?
  business_hours_special_list      business_hours_special_list[]
  category_mirror_runs             category_mirror_runs[]
  directory_featured_listings_list directory_featured_listings_list[]
  directory_photos                 directory_photos[]
  directory_settings_list          directory_settings_list?
  featured_products                featured_products[]
  gbp_attributes                   gbp_attributes[]
  gbp_media                        gbp_media[]
  gbp_posts                        gbp_posts[]
  gbp_reviews                      gbp_reviews[]
  gbp_sync_history                 gbp_sync_history[]
  gbp_sync_tracking                gbp_sync_tracking[]
  google_oauth_accounts_list       google_oauth_accounts_list[]
  inventory_items                  inventory_items[]
  invitations                      invitations[]
  location_status_logs             location_status_logs[]
  oauth_tokens                     oauth_tokens[]
  orders                           orders[]
  payments                         payments[]
  photo_assets                     photo_assets[]
  platform_fee_overrides           platform_fee_overrides[]
  product_performances             product_performances[]
  product_variants                 product_variants[]
  refunds                          refunds[]
  scan_results_list                scan_results_list[]
  scan_sessions_list               scan_sessions_list[]
  scan_templates_list              scan_templates_list[]
  shipments                        shipments[]
  shopping_carts                   shopping_carts[]
  sync_jobs                        sync_jobs[]
  tenant_business_profiles_list    tenant_business_profiles_list?
  tenant_feature_overrides_list    tenant_feature_overrides_list[]
  fulfillment_settings             tenant_fulfillment_settings?
  payment_gateways                 tenant_payment_gateways[]
  shipping_carriers                tenant_shipping_carriers[]
  organizations_list               organizations_list?                @relation(fields: [organization_id], references: [id])
  user_tenants                     user_tenants[]

  @@index([directory_visible], map: "idx_tenant_directory_visible")
  @@index([google_sync_enabled, google_last_sync], map: "idx_tenant_google_sync")
  @@index([slug], map: "idx_tenant_slug")
  @@index([created_by], map: "tenant_created_by_idx")
  @@index([directory_visible], map: "tenant_directory_visible_idx")
  @@index([google_sync_enabled, google_last_sync], map: "tenant_google_sync_enabled_google_last_sync_idx")
  @@index([location_status], map: "tenant_location_status_idx")
  @@index([location_status], map: "tenant_locationstatus_idx")
  @@index([name], map: "tenant_name_idx")
  @@index([organization_id], map: "tenant_organizationid_idx")
  @@index([service_level], map: "tenant_servicelevel_idx")
  @@index([slug], map: "tenant_slug_idx")
  @@index([subscription_status], map: "tenant_subscriptionstatus_idx")
}

model tier_change_logs_list {
  id               String   @id
  entity_type      String
  entity_id        String
  action           String
  change_type      String
  before_state     Json?
  after_state      Json?
  changed_by       String
  changed_by_email String?
  reason           String?
  ip_address       String?
  user_agent       String?
  created_at       DateTime @default(now())
}

model tier_features_list {
  id                      String                  @id
  tier_id                 String
  feature_key             String
  feature_name            String
  is_enabled              Boolean                 @default(true)
  is_inherited            Boolean                 @default(false)
  metadata                Json?
  created_at              DateTime                @default(now())
  updated_at              DateTime                @default(now())
  subscription_tiers_list subscription_tiers_list @relation(fields: [tier_id], references: [id], onDelete: Cascade)

  @@unique([tier_id, feature_key])
}

model upgrade_requests {
  id             String    @id
  tenant_id      String
  business_name  String
  current_tier   String
  requested_tier String
  status         String    @default("new")
  notes          String?
  admin_notes    String?
  processed_by   String?
  processed_at   DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime
}

model user_behavior_simple {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id          String?   @db.VarChar(255)
  session_id       String?   @db.VarChar(255)
  entity_type      String    @db.VarChar(20)
  entity_id        String
  entity_name      String?   @db.VarChar(255)
  context          Json?
  timestamp        DateTime? @default(now()) @db.Timestamptz(6)
  location_lat     Decimal?  @db.Decimal(10, 8)
  location_lng     Decimal?  @db.Decimal(11, 8)
  referrer         String?   @db.VarChar(500)
  user_agent       String?
  ip_address       String?   @db.Inet
  duration_seconds Int?
  page_type        String?   @db.VarChar(50)

  @@index([context], map: "idx_user_behavior_simple_context_gin", type: Gin)
  @@index([entity_type, entity_id, timestamp(sort: Desc)], map: "idx_user_behavior_simple_entity")
  @@index([page_type, timestamp(sort: Desc)], map: "idx_user_behavior_simple_page_type")
  @@index([timestamp(sort: Desc)], map: "idx_user_behavior_simple_timestamp")
  @@index([user_id, timestamp(sort: Desc)], map: "idx_user_behavior_simple_user_timestamp")
}

model user_sessions_list {
  user_id       String
  device_info   String?
  ip_address    String?
  user_agent    String?
  is_active     Boolean   @default(true)
  created_at    DateTime  @default(now())
  expires_at    DateTime
  location      Json?
  last_activity DateTime?
  token_hash    String?   @unique
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  users         users     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([expires_at])
  @@index([user_id])
  @@index([last_activity])
}

model user_tenants {
  id         String           @id
  user_id    String
  tenant_id  String
  role       user_tenant_role @default(MEMBER)
  created_at DateTime         @default(now())
  updated_at DateTime
  tenants    tenants          @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  users      users            @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, tenant_id], map: "user_id_tenant_id_unique")
  @@index([tenant_id])
  @@index([user_id])
}

model users {
  id                               String                             @id
  email                            String                             @unique
  password_hash                    String
  first_name                       String?
  last_name                        String?
  role                             user_role                          @default(USER)
  email_verified                   Boolean                            @default(false)
  email_verification_token         String?
  password_reset_token             String?
  password_reset_expires           DateTime?
  last_login                       DateTime?
  is_active                        Boolean                            @default(true)
  created_at                       DateTime                           @default(now())
  updated_at                       DateTime
  mfa_enabled                      Boolean?                           @default(false)
  mfa_secret                       String?
  mfa_backup_codes                 String[]
  mfa_method                       String?                            @db.VarChar(50)
  mfa_verified_at                  DateTime?                          @db.Timestamp(6)
  consent_records                  consent_records[]
  directory_featured_listings_list directory_featured_listings_list[]
  invitations                      invitations[]
  login_attempts                   login_attempts[]
  order_status_history             order_status_history[]
  security_alerts                  security_alerts[]
  security_threats                 security_threats[]
  shopping_carts                   shopping_carts[]
  user_preferences                 user_preferences[]
  user_sessions_list               user_sessions_list[]
  user_tenants                     user_tenants[]
}

model consent_records {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String   @db.VarChar
  consent_type String   @db.VarChar
  consented    Boolean  @default(false)
  ip_address   String?  @db.VarChar
  user_agent   String?  @db.VarChar
  source       String   @default("web") @db.VarChar
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  updated_at   DateTime @default(now()) @db.Timestamptz(6)
  users        users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_consent_records_user")

  @@index([created_at], map: "idx_consent_records_created_at")
  @@index([user_id, consent_type], map: "idx_consent_records_user_type")
}

model user_preferences {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String   @db.VarChar
  key        String   @db.VarChar
  value      Json
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @default(now()) @db.Timestamptz(6)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_preferences_user")

  @@unique([user_id, key], map: "unique_user_preference")
  @@index([user_id], map: "idx_user_preferences_user")
}

model security_threats {
  id          String    @id @default(dbgenerated("('threat_'::text || (gen_random_uuid())::text)")) @db.VarChar(255)
  user_id     String?   @db.VarChar(255)
  type        String    @db.VarChar(50)
  severity    String    @default("medium") @db.VarChar(20)
  ip_address  String?   @db.VarChar(45)
  user_agent  String?
  description String?
  metadata    Json?     @default("{}")
  resolved    Boolean?  @default(false)
  resolved_at DateTime?
  resolved_by String?   @db.VarChar(255)
  created_at  DateTime  @default(now())
  updated_at  DateTime  @default(now())
  users       users?    @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([user_id])
  @@index([ip_address])
  @@index([type])
  @@index([severity])
  @@index([created_at])
  @@index([resolved])
}

model login_attempts {
  id             String   @id @default(dbgenerated("('attempt_'::text || (gen_random_uuid())::text)")) @db.VarChar(255)
  user_id        String?  @db.VarChar(255)
  email          String   @db.VarChar(255)
  ip_address     String?  @db.VarChar(45)
  user_agent     String?
  success        Boolean
  failure_reason String?  @db.VarChar(100)
  metadata       Json?    @default("{}")
  created_at     DateTime @default(now())
  users          users?   @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id])
  @@index([email])
  @@index([ip_address])
  @@index([success])
  @@index([created_at])
}

model security_alerts {
  id              String    @id @default(dbgenerated("('alert_'::text || (gen_random_uuid())::text)")) @db.VarChar(255)
  user_id         String?   @db.VarChar(255)
  type            String    @db.VarChar(50)
  severity        String    @default("info") @db.VarChar(20)
  title           String    @db.VarChar(255)
  message         String
  metadata        Json?     @default("{}")
  read            Boolean   @default(false)
  dismissed       Boolean   @default(false)
  created_at      DateTime  @default(now())
  read_at         DateTime?
  dismissed_at    DateTime?
  updated_at      DateTime  @default(now())
  user_email      String?   @db.VarChar(255)
  user_first_name String?   @db.VarChar(255)
  user_last_name  String?   @db.VarChar(255)
  users           users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id])
  @@index([type])
  @@index([severity])
  @@index([read])
  @@index([dismissed])
  @@index([created_at])
}

model mv_refresh_throttle {
  mv_name         String   @id
  last_refresh_at DateTime @default(now()) @db.Timestamptz(6)
  refresh_count   Int      @default(0)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model recommendations_mv_refresh_log {
  id                   Int       @id @default(autoincrement())
  mv_name              String
  refresh_started_at   DateTime  @default(now()) @db.Timestamptz(6)
  refresh_completed_at DateTime? @db.Timestamptz(6)
  refresh_duration_ms  Int?
  status               String    @default("running")
  error_message        String?
  rows_affected        Int?

  @@index([mv_name, refresh_started_at(sort: Desc)], map: "idx_recommendations_mv_refresh_log_mv_name")
}

model orders {
  id                     String                  @id @db.VarChar(255)
  tenant_id              String                  @db.VarChar(255)
  customer_id            String?                 @db.VarChar(255)
  order_number           String                  @unique @db.VarChar(255)
  order_status           order_status            @default(draft)
  payment_status         payment_status          @default(pending)
  fulfillment_status     fulfillment_status      @default(unfulfilled)
  subtotal_cents         Int                     @default(0)
  tax_cents              Int                     @default(0)
  shipping_cents         Int                     @default(0)
  discount_cents         Int                     @default(0)
  total_cents            Int                     @default(0)
  currency               String                  @default("USD") @db.VarChar(3)
  customer_email         String                  @db.VarChar(255)
  customer_name          String?                 @db.VarChar(255)
  customer_phone         String?                 @db.VarChar(50)
  shipping_address_line1 String?                 @db.VarChar(255)
  shipping_address_line2 String?                 @db.VarChar(255)
  shipping_city          String?                 @db.VarChar(100)
  shipping_state         String?                 @db.VarChar(100)
  shipping_postal_code   String?                 @db.VarChar(20)
  shipping_country       String?                 @default("US") @db.VarChar(2)
  billing_address_line1  String?                 @db.VarChar(255)
  billing_address_line2  String?                 @db.VarChar(255)
  billing_city           String?                 @db.VarChar(100)
  billing_state          String?                 @db.VarChar(100)
  billing_postal_code    String?                 @db.VarChar(20)
  billing_country        String?                 @default("US") @db.VarChar(2)
  notes                  String?
  internal_notes         String?
  metadata               Json?                   @default("{}")
  source                 String?                 @db.VarChar(50)
  source_id              String?                 @db.VarChar(255)
  ip_address             String?                 @db.VarChar(45)
  user_agent             String?
  confirmed_at           DateTime?               @db.Timestamp(6)
  paid_at                DateTime?               @db.Timestamp(6)
  fulfilled_at           DateTime?               @db.Timestamp(6)
  cancelled_at           DateTime?               @db.Timestamp(6)
  created_at             DateTime                @default(now()) @db.Timestamp(6)
  updated_at             DateTime                @default(now()) @db.Timestamp(6)
  shipping_provider      String?                 @db.VarChar(50)
  digital_access_grants  digital_access_grants[]
  order_items            order_items[]
  order_status_history   order_status_history[]
  tenants                tenants                 @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_orders_tenant_id")
  payments               payments[]
  refunds                refunds[]
  shipments              shipments[]

  @@index([tenant_id, order_status], map: "idx_orders_tenant_id_status")
  @@index([tenant_id, created_at(sort: Desc)], map: "idx_orders_tenant_id_created_at")
  @@index([customer_id], map: "idx_orders_customer_id")
  @@index([customer_email], map: "idx_orders_customer_email")
  @@index([order_number], map: "idx_orders_order_number")
  @@index([tenant_id, order_number], map: "idx_orders_tenant_id_order_number")
  @@index([source], map: "idx_orders_source")
  @@index([payment_status], map: "idx_orders_payment_status")
  @@index([fulfillment_status], map: "idx_orders_fulfillment_status")
  @@index([shipping_provider], map: "idx_orders_shipping_provider")
}

model order_items {
  id                      String                   @id @db.VarChar(255)
  order_id                String                   @db.VarChar(255)
  inventory_item_id       String?                  @db.VarChar(255)
  sku                     String                   @db.VarChar(255)
  name                    String                   @db.VarChar(500)
  description             String?
  image_url               String?
  quantity                Int                      @default(1)
  unit_price_cents        Int
  subtotal_cents          Int
  tax_cents               Int                      @default(0)
  discount_cents          Int                      @default(0)
  total_cents             Int
  quantity_fulfilled      Int                      @default(0)
  quantity_refunded       Int                      @default(0)
  is_refundable           Boolean                  @default(true)
  metadata                Json?                    @default("{}")
  notes                   String?
  created_at              DateTime                 @default(now()) @db.Timestamp(6)
  updated_at              DateTime                 @default(now()) @db.Timestamp(6)
  list_price_cents        Int?
  product_type            product_type             @default(physical)
  digital_delivery_status digital_delivery_status? @default(pending)
  digital_delivered_at    DateTime?                @db.Timestamptz(6)
  variant_id              String?
  variant_name            String?
  variant_attributes      Json?
  digital_access_grants   digital_access_grants[]
  inventory_items         inventory_items?         @relation(fields: [inventory_item_id], references: [id], onUpdate: NoAction, map: "fk_order_items_inventory_item_id")
  orders                  orders                   @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_order_items_order_id")
  product_variants        product_variants?        @relation(fields: [variant_id], references: [id], onUpdate: NoAction)

  @@index([order_id], map: "idx_order_items_order_id")
  @@index([inventory_item_id], map: "idx_order_items_inventory_item_id")
  @@index([sku], map: "idx_order_items_sku")
  @@index([product_type], map: "idx_order_items_product_type")
}

model payments {
  id                        String          @id @db.VarChar(255)
  order_id                  String          @db.VarChar(255)
  tenant_id                 String          @db.VarChar(255)
  amount_cents              Int
  currency                  String          @default("USD") @db.VarChar(3)
  payment_method            payment_method?
  payment_status            payment_status  @default(pending)
  gateway                   String?         @db.VarChar(50)
  gateway_transaction_id    String?         @unique @db.VarChar(255)
  gateway_customer_id       String?         @db.VarChar(255)
  gateway_payment_method_id String?         @db.VarChar(255)
  payment_method_details    Json?
  authorized_at             DateTime?       @db.Timestamp(6)
  captured_at               DateTime?       @db.Timestamp(6)
  failed_at                 DateTime?       @db.Timestamp(6)
  cancelled_at              DateTime?       @db.Timestamp(6)
  error_code                String?         @db.VarChar(100)
  error_message             String?
  metadata                  Json?           @default("{}")
  ip_address                String?         @db.VarChar(45)
  created_at                DateTime        @default(now()) @db.Timestamp(6)
  updated_at                DateTime        @default(now()) @db.Timestamp(6)
  gateway_type              String?
  gateway_authorization_id  String?
  gateway_fee_cents         Int?            @default(0)
  net_amount_cents          Int?
  gateway_response          Json?           @default("{}")
  authorization_expires_at  DateTime?       @db.Timestamp(6)
  platform_fee_cents        Int?            @default(0)
  platform_fee_percentage   Decimal?        @db.Decimal(5, 2)
  platform_fee_fixed_cents  Int?            @default(0)
  total_fees_cents          Int?            @default(0)
  fee_waived                Boolean?        @default(false)
  fee_waived_reason         String?
  orders                    orders          @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_payments_order_id")
  tenants                   tenants         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_payments_tenant_id")
  refunds                   refunds[]

  @@index([order_id], map: "idx_payments_order_id")
  @@index([tenant_id], map: "idx_payments_tenant_id")
  @@index([gateway_transaction_id], map: "idx_payments_gateway_transaction_id")
  @@index([gateway], map: "idx_payments_gateway")
  @@index([payment_status], map: "idx_payments_payment_status")
  @@index([created_at, payment_status], map: "idx_payments_created_at_status")
  @@index([gateway_authorization_id], map: "idx_payments_gateway_authorization")
  @@index([gateway_transaction_id], map: "idx_payments_gateway_transaction")
  @@index([gateway_type], map: "idx_payments_gateway_type")
}

model shipments {
  id                      String          @id @db.VarChar(255)
  order_id                String          @db.VarChar(255)
  tenant_id               String          @db.VarChar(255)
  carrier                 String?         @db.VarChar(50)
  service_level           String?         @db.VarChar(50)
  tracking_number         String?         @db.VarChar(255)
  tracking_url            String?
  shipment_status         shipment_status @default(pending)
  address_line1           String          @db.VarChar(255)
  address_line2           String?         @db.VarChar(255)
  city                    String          @db.VarChar(100)
  state                   String          @db.VarChar(100)
  postal_code             String          @db.VarChar(20)
  country                 String          @default("US") @db.VarChar(2)
  shipping_cost_cents     Int?
  label_cost_cents        Int?
  label_url               String?
  label_format            String?         @db.VarChar(10)
  weight_oz               Decimal?        @db.Decimal(10, 2)
  length_in               Decimal?        @db.Decimal(10, 2)
  width_in                Decimal?        @db.Decimal(10, 2)
  height_in               Decimal?        @db.Decimal(10, 2)
  shipped_at              DateTime?       @db.Timestamp(6)
  in_transit_at           DateTime?       @db.Timestamp(6)
  out_for_delivery_at     DateTime?       @db.Timestamp(6)
  delivered_at            DateTime?       @db.Timestamp(6)
  failed_delivery_at      DateTime?       @db.Timestamp(6)
  returned_at             DateTime?       @db.Timestamp(6)
  metadata                Json?           @default("{}")
  notes                   String?
  created_at              DateTime        @default(now()) @db.Timestamp(6)
  updated_at              DateTime        @default(now()) @db.Timestamp(6)
  carrier_type            String?
  label_id                String?
  rate_cents              Int?
  estimated_delivery_date DateTime?       @db.Date
  carrier_response        Json?           @default("{}")
  tracking_events         Json?           @default("[]")
  orders                  orders          @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_shipments_order_id")
  tenants                 tenants         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_shipments_tenant_id")

  @@index([order_id], map: "idx_shipments_order_id")
  @@index([tenant_id], map: "idx_shipments_tenant_id")
  @@index([tracking_number], map: "idx_shipments_tracking_number")
  @@index([shipment_status], map: "idx_shipments_shipment_status")
  @@index([carrier], map: "idx_shipments_carrier")
  @@index([carrier_type], map: "idx_shipments_carrier_type")
  @@index([label_id], map: "idx_shipments_label_id")
}

model order_status_history {
  id                 String        @id @db.VarChar(255)
  order_id           String        @db.VarChar(255)
  from_status        order_status?
  to_status          order_status
  changed_by_user_id String?       @db.VarChar(255)
  changed_by_name    String?       @db.VarChar(255)
  reason             String?
  notes              String?
  metadata           Json?         @default("{}")
  created_at         DateTime      @default(now()) @db.Timestamp(6)
  users              users?        @relation(fields: [changed_by_user_id], references: [id], onUpdate: NoAction, map: "fk_order_status_history_changed_by_user_id")
  orders             orders        @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_order_status_history_order_id")

  @@index([order_id, created_at(sort: Desc)], map: "idx_order_status_history_order_id_created_at")
  @@index([changed_by_user_id], map: "idx_order_status_history_changed_by_user_id")
}

model refunds {
  id                String    @id @db.VarChar(255)
  payment_id        String    @db.VarChar(255)
  order_id          String    @db.VarChar(255)
  tenant_id         String    @db.VarChar(255)
  amount_cents      Int
  refund_status     String    @default("pending") @db.VarChar(50)
  refund_reason     String?
  gateway_type      String    @db.VarChar(50)
  gateway_refund_id String?   @db.VarChar(255)
  gateway_response  Json?
  created_at        DateTime  @default(now()) @db.Timestamptz(6)
  processed_at      DateTime? @db.Timestamptz(6)
  completed_at      DateTime? @db.Timestamptz(6)
  initiated_by      String?   @db.VarChar(255)
  metadata          Json?
  orders            orders    @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_refunds_order")
  payments          payments  @relation(fields: [payment_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_refunds_payment")
  tenants           tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_refunds_tenant")

  @@index([created_at(sort: Desc)], map: "idx_refunds_created_at")
  @@index([order_id], map: "idx_refunds_order_id")
  @@index([payment_id], map: "idx_refunds_payment_id")
  @@index([refund_status], map: "idx_refunds_status")
  @@index([tenant_id], map: "idx_refunds_tenant_id")
  @@map("refunds")
}

model tenant_payment_gateways {
  id                       String            @id
  tenant_id                String
  gateway_type             String
  is_active                Boolean?          @default(false)
  is_default               Boolean?          @default(false)
  api_key_encrypted        String?
  api_secret_encrypted     String?
  webhook_secret_encrypted String?
  config                   Json?             @default("{}")
  default_flow             String?           @default("authorize_capture")
  auto_capture_delay_hours Int?              @default(168)
  last_verified_at         DateTime?         @db.Timestamp(6)
  verification_status      String?
  verification_error       String?
  metadata                 Json?             @default("{}")
  created_at               DateTime?         @default(now()) @db.Timestamp(6)
  updated_at               DateTime?         @default(now()) @updatedAt @db.Timestamp(6)
  oauth_connected          Boolean?          @default(false)
  oauth_merchant_id        String?           @db.VarChar(255)
  inventory_items          inventory_items[]
  tenants                  tenants           @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_tenant_payment_gateways_tenant")

  @@unique([tenant_id, gateway_type], map: "uq_tenant_gateway_type")
  @@index([tenant_id, is_active], map: "idx_tenant_payment_gateways_active")
  @@index([tenant_id, is_default], map: "idx_tenant_payment_gateways_default")
  @@index([gateway_type], map: "idx_tenant_payment_gateways_gateway_type")
  @@index([tenant_id], map: "idx_tenant_payment_gateways_tenant")
  @@index([tenant_id, gateway_type], map: "idx_tenant_payment_gateways_tenant_gateway")
  @@index([oauth_connected], map: "idx_tenant_payment_gateways_oauth")
  @@map("tenant_payment_gateways")
}

model tenant_shipping_carriers {
  id                       String    @id
  tenant_id                String
  carrier_type             String
  is_active                Boolean?  @default(false)
  is_default               Boolean?  @default(false)
  api_key_encrypted        String?
  api_secret_encrypted     String?
  account_number_encrypted String?
  config                   Json?     @default("{}")
  default_service_level    String?
  enable_rate_shopping     Boolean?  @default(true)
  enable_label_generation  Boolean?  @default(true)
  origin_address_line1     String?
  origin_address_line2     String?
  origin_city              String?
  origin_state             String?
  origin_postal_code       String?
  origin_country           String?   @default("US")
  origin_phone             String?
  last_verified_at         DateTime? @db.Timestamp(6)
  verification_status      String?
  verification_error       String?
  metadata                 Json?     @default("{}")
  created_at               DateTime? @default(now()) @db.Timestamp(6)
  updated_at               DateTime? @default(now()) @updatedAt @db.Timestamp(6)
  tenants                  tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_tenant_shipping_carriers_tenant")

  @@unique([tenant_id, carrier_type], map: "uq_tenant_carrier_type")
  @@index([tenant_id, is_active], map: "idx_tenant_shipping_carriers_active")
  @@index([carrier_type], map: "idx_tenant_shipping_carriers_carrier_type")
  @@index([tenant_id, is_default], map: "idx_tenant_shipping_carriers_default")
  @@index([tenant_id], map: "idx_tenant_shipping_carriers_tenant")
  @@map("tenant_shipping_carriers")
}

model tenant_fulfillment_settings {
  id                        String    @id
  tenant_id                 String    @unique
  pickup_enabled            Boolean?  @default(true)
  pickup_instructions       String?
  pickup_ready_time_minutes Int?      @default(120)
  delivery_enabled          Boolean?  @default(false)
  delivery_radius_miles     Decimal?  @db.Decimal(10, 2)
  delivery_fee_cents        Int?      @default(0)
  delivery_min_free_cents   Int?
  delivery_time_hours       Int?      @default(24)
  delivery_instructions     String?
  shipping_enabled          Boolean?  @default(false)
  shipping_flat_rate_cents  Int?
  shipping_zones            Json?     @default("[]")
  shipping_handling_days    Int?      @default(2)
  created_at                DateTime? @default(now()) @db.Timestamp(6)
  updated_at                DateTime? @default(now()) @updatedAt @db.Timestamp(6)
  shipping_provider         String?   @db.VarChar(50)
  tenants                   tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_tenant")

  @@index([delivery_enabled], map: "idx_fulfillment_delivery")
  @@index([pickup_enabled], map: "idx_fulfillment_pickup")
  @@index([shipping_enabled], map: "idx_fulfillment_shipping")
  @@index([tenant_id], map: "idx_fulfillment_tenant")
  @@map("tenant_fulfillment_settings")
}

model platform_fee_tiers {
  id                    String    @id
  tier_name             String    @unique
  fee_percentage        Decimal?  @default(0.00) @db.Decimal(5, 2)
  fee_fixed_cents       Int?      @default(0)
  min_transaction_cents Int?
  max_transaction_cents Int?
  description           String?
  is_active             Boolean?  @default(true)
  created_at            DateTime? @default(now()) @db.Timestamp(6)
  updated_at            DateTime? @default(now()) @updatedAt @db.Timestamp(6)

  @@map("platform_fee_tiers")
}

model platform_fee_overrides {
  id                String    @id
  tenant_id         String
  fee_percentage    Decimal?  @db.Decimal(5, 2)
  fee_fixed_cents   Int?
  reason            String
  approved_by       String?
  approved_by_email String?
  starts_at         DateTime? @default(now()) @db.Timestamp(6)
  expires_at        DateTime? @db.Timestamp(6)
  is_active         Boolean?  @default(true)
  metadata          Json?     @default("{}")
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  updated_at        DateTime? @default(now()) @updatedAt @db.Timestamp(6)
  tenants           tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_platform_fee_overrides_tenant")

  @@index([tenant_id, is_active, starts_at, expires_at], map: "idx_platform_fee_overrides_active")
  @@index([tenant_id], map: "idx_platform_fee_overrides_tenant")
  @@map("platform_fee_overrides")
}

model webhook_events {
  id            String    @id
  event_type    String
  event_id      String    @unique(map: "webhook_events_event_id_unique")
  payload       Json      @default("{}")
  processed     Boolean?  @default(false)
  error_message String?
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  processed_at  DateTime? @db.Timestamp(6)

  @@index([created_at(sort: Desc)], map: "idx_webhook_events_created_at")
  @@index([event_id], map: "idx_webhook_events_event_id")
  @@index([event_type], map: "idx_webhook_events_event_type")
  @@index([processed], map: "idx_webhook_events_processed")
  @@map("webhook_events")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model enum_count {
  count BigInt?

  @@ignore
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model fk_count {
  count BigInt?

  @@ignore
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model index_count {
  count BigInt?

  @@ignore
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model shopping_cart_items {
  id                String           @id @default(dbgenerated("('item_'::text || (gen_random_uuid())::text)"))
  cart_id           String
  inventory_item_id String?
  product_id        String
  product_name      String
  product_sku       String
  product_image_url String?
  unit_price_cents  Int
  quantity          Int              @default(1)
  added_at          DateTime         @default(now()) @db.Timestamptz(6)
  updated_at        DateTime         @default(now()) @db.Timestamptz(6)
  metadata          Json?            @default("{}")
  shopping_carts    shopping_carts   @relation(fields: [cart_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_cart_items_cart")
  inventory_items   inventory_items? @relation(fields: [inventory_item_id], references: [id], onUpdate: NoAction, map: "fk_cart_items_inventory")

  @@unique([cart_id, product_id], map: "idx_cart_items_cart_product")
  @@index([cart_id], map: "idx_cart_items_cart")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model shopping_carts {
  id                  String                @id @default(dbgenerated("('cart_'::text || (gen_random_uuid())::text)"))
  user_id             String?
  tenant_id           String
  session_id          String?
  tenant_name         String
  tenant_logo         String?
  status              String                @default("active")
  created_at          DateTime              @default(now()) @db.Timestamptz(6)
  updated_at          DateTime              @default(now()) @db.Timestamptz(6)
  last_activity_at    DateTime              @default(now()) @db.Timestamptz(6)
  expires_at          DateTime?             @db.Timestamptz(6)
  metadata            Json?                 @default("{}")
  shopping_cart_items shopping_cart_items[]
  tenants             tenants               @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_shopping_carts_tenant")
  users               users?                @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_shopping_carts_user")

  @@index([user_id, status, last_activity_at(sort: Desc)], map: "idx_shopping_carts_user_status")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model table_count {
  count BigInt?

  @@ignore
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model trigger_count {
  count BigInt?

  @@ignore
}

model oauth_tokens {
  id                String    @id @default(cuid())
  tenant_id         String
  gateway_type      String
  access_token      String
  refresh_token     String?
  token_type        String    @default("Bearer")
  expires_at        DateTime
  scope             String?
  merchant_id       String?
  merchant_email    String?
  created_at        DateTime  @default(now())
  updated_at        DateTime  @default(now()) @updatedAt
  last_refreshed_at DateTime?
  encrypted_tokens  String?
  tenants           tenants   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_oauth_tokens_tenant")

  @@unique([tenant_id, gateway_type], map: "uq_oauth_tokens_tenant_gateway")
  @@index([tenant_id], map: "idx_oauth_tokens_tenant")
  @@index([gateway_type], map: "idx_oauth_tokens_gateway_type")
  @@index([expires_at], map: "idx_oauth_tokens_expires_at")
  @@index([encrypted_tokens], map: "idx_oauth_tokens_encrypted_tokens")
  @@map("oauth_tokens")
}

model digital_access_grants {
  id                String          @id @db.VarChar(255)
  order_id          String          @db.VarChar(255)
  order_item_id     String          @db.VarChar(255)
  inventory_item_id String          @db.VarChar(255)
  customer_email    String          @db.VarChar(500)
  access_token      String          @unique @db.VarChar(255)
  download_count    Int             @default(0)
  download_limit    Int?
  expires_at        DateTime?       @db.Timestamptz(6)
  first_accessed_at DateTime?       @db.Timestamptz(6)
  last_accessed_at  DateTime?       @db.Timestamptz(6)
  revoked_at        DateTime?       @db.Timestamptz(6)
  revoked_reason    String?
  created_at        DateTime        @default(now()) @db.Timestamptz(6)
  updated_at        DateTime        @default(now()) @db.Timestamptz(6)
  inventory_items   inventory_items @relation(fields: [inventory_item_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_digital_access_grants_inventory_item_id")
  orders            orders          @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_digital_access_grants_order_id")
  order_items       order_items     @relation(fields: [order_item_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_digital_access_grants_order_item_id")

  @@index([customer_email], map: "idx_digital_access_grants_customer_email")
  @@index([access_token], map: "idx_digital_access_grants_access_token")
  @@index([order_id], map: "idx_digital_access_grants_order_id")
  @@index([inventory_item_id], map: "idx_digital_access_grants_inventory_item_id")
}

model product_variants {
  id               String          @id
  parent_item_id   String
  tenant_id        String
  sku              String
  variant_name     String
  price_cents      Int?
  sale_price_cents Int?
  stock            Int             @default(0)
  image_url        String?
  attributes       Json            @default("{}")
  sort_order       Int?            @default(0)
  is_active        Boolean?        @default(true)
  created_at       DateTime?       @default(now()) @db.Timestamp(6)
  updated_at       DateTime?       @default(now()) @db.Timestamp(6)
  order_items      order_items[]
  photo_assets     photo_assets[]
  tenants          tenants         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_tenant")
  inventory_items  inventory_items @relation(fields: [parent_item_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, sku], map: "unique_tenant_variant_sku")
  @@index([parent_item_id], map: "idx_product_variants_parent")
  @@index([sku], map: "idx_product_variants_sku")
  @@index([tenant_id], map: "idx_product_variants_tenant")
}

model rate_limit_configurations {
  id             String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  route_type     String    @unique(map: "idx_rate_limit_configurations_route_type")
  max_requests   Int       @default(100)
  window_minutes Int       @default(1)
  enabled        Boolean   @default(true)
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  updated_at     DateTime? @default(now()) @updatedAt @db.Timestamptz(6)
}

model rate_limit_warnings {
  id            String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  client_id     String
  pathname      String
  request_count Int
  max_requests  Int
  window_ms     Int
  ip_address    String?
  user_agent    String?
  occurred_at   DateTime? @default(now()) @db.Timestamptz(6)
  blocked       Boolean?  @default(false)

  @@index([client_id, occurred_at(sort: Desc)], map: "idx_rate_limit_warnings_client_id_occurred_at_desc")
  @@index([pathname, occurred_at(sort: Desc)], map: "idx_rate_limit_warnings_pathname_occurred_at_desc")
  @@index([occurred_at(sort: Desc)], map: "idx_rate_limit_warnings_occurred_at_desc")
  @@map("rate_limit_warnings")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model featured_products {
  id                  String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  inventory_item_id   String
  tenant_id           String
  featured_type       String          @db.VarChar(50)
  featured_priority   Int?            @default(50)
  featured_at         DateTime?       @default(now()) @db.Timestamp(6)
  featured_expires_at DateTime?       @db.Timestamp(6)
  auto_unfeature      Boolean?        @default(true)
  is_active           Boolean?        @default(true)
  inventory_items     inventory_items @relation(fields: [inventory_item_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_featured_products_inventory_item")
  tenants             tenants         @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_featured_products_tenant")

  @@unique([inventory_item_id, featured_type], map: "unique_featured_item")
  @@index([tenant_id, is_active, featured_type], map: "idx_featured_active")
  @@index([inventory_item_id], map: "idx_featured_item")
  @@index([featured_priority(sort: Desc)], map: "idx_featured_priority")
  @@index([tenant_id, featured_type], map: "idx_featured_tenant_type")
  @@map("featured_products")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model failed_login_attempts {
  id         Int       @id @default(autoincrement())
  email      String    @db.VarChar(255)
  ip_address String    @db.VarChar(45)
  user_agent String?
  reason     String    @db.VarChar(100)
  metadata   Json?     @default("{}")
  created_at DateTime? @default(now()) @db.Timestamptz(6)

  @@index([created_at], map: "idx_failed_login_attempts_created_at")
  @@index([email], map: "idx_failed_login_attempts_email")
  @@index([ip_address], map: "idx_failed_login_attempts_ip")
}

enum action {
  create
  update
  delete
  sync
  policyApply
  oauthConnect
  oauthRefresh
}

enum actor_type {
  user
  system
  integration
}

enum availability_status {
  in_stock
  out_of_stock
  preorder
}

enum enrichment_status {
  NEEDS_ENRICHMENT
  PARTIALLY_ENRICHED
  PENDING
  COMPLETE
  FAILED
}

enum entity_status {
  pending
  active
  inactive
  closed
  archived
}

enum entity_type {
  inventory_item
  tenant
  policy
  oauth
  other
}

enum item_status {
  active
  inactive
  archived
  trashed
}

enum item_visibility {
  public
  private
}

enum job_status {
  queued
  processing
  success
  failed
}

enum location_status {
  pending
  active
  inactive
  closed
  archived
}

enum permission_action {
  tenant_create          @map("tenant.create")
  tenant_read            @map("tenant.read")
  tenant_update          @map("tenant.update")
  tenant_delete          @map("tenant.delete")
  tenant_manage_users    @map("tenant.manage_users")
  inventory_create       @map("inventory.create")
  inventory_read         @map("inventory.read")
  inventory_update       @map("inventory.update")
  inventory_delete       @map("inventory.delete")
  analytics_view         @map("analytics.view")
  admin_access_dashboard @map("admin.access_dashboard")
  admin_manage_settings  @map("admin.manage_settings")
}

enum product_condition {
  brand_new
  refurbished
  used
}

enum product_source {
  MANUAL
  BARCODE_SCAN
  BULK_UPLOAD
  API_IMPORT
  QUICK_START_WIZARD
  CLOVER_DEMO
}

enum sync_status {
  pending
  success
  error
}

enum user_role {
  PLATFORM_ADMIN
  PLATFORM_SUPPORT
  PLATFORM_VIEWER
  ADMIN
  OWNER
  USER
  TENANT_OWNER
  TENANT_ADMIN
  TENANT_MANAGER
  TENANT_MEMBER
  TENANT_VIEWER
}

enum review_status {
  pending
  approved
  rejected
}

enum user_tenant_role {
  OWNER
  ADMIN
  SUPPORT
  MEMBER
  VIEWER
}

enum order_status {
  draft
  confirmed
  paid
  processing
  shipped
  delivered
  cancelled
  refunded
}

enum payment_status {
  pending
  authorized
  paid
  partially_refunded
  refunded
  failed
  cancelled
}

enum fulfillment_status {
  unfulfilled
  partially_fulfilled
  fulfilled
  cancelled
}

enum payment_method {
  credit_card
  debit_card
  paypal
  apple_pay
  google_pay
  cash
  check
  bank_transfer
  other
}

enum shipment_status {
  pending
  label_created
  picked_up
  in_transit
  out_for_delivery
  delivered
  failed_delivery
  returned
  cancelled
}

enum product_type {
  physical
  digital
  hybrid
}

enum digital_delivery_method {
  direct_download
  external_link
  license_key
  access_grant
}

enum license_type {
  personal
  commercial
  educational
  enterprise
}

enum digital_delivery_status {
  pending
  delivered
  failed
  revoked
}
